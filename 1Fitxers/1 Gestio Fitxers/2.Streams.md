# Apunts: Fluxos de Dades (Streams) en Java

---

## Introducció

Quan un programa necessita **comunicar-se amb l’exterior** (llegir un fitxer, escriure un informe, rebre dades d’Internet o enviar informació a la consola), necessita un **flux de dades (stream)**.

Un **flux** és un **camí seqüencial** pel qual les dades entren (entrada) o ixen (eixida) del programa.

**Passos bàsics en qualsevol flux:**

1. **Obrir** el flux (crear l’objecte adequat).
2. **Usar** el flux (llegir o escriure).
3. **Tancar** amb `close()` per alliberar recursos.

### Dos grans famílies de fluxos

| Família                 | Classe base                    | Unitat de treball           | Ús                                              |
| ----------------------- | ------------------------------ | --------------------------- | ----------------------------------------------- |
| **Fluxos de bytes**     | `InputStream` / `OutputStream` | Byte (8 bits)               | Dades binàries: imatges, vídeos, fitxers `.exe` |
| **Fluxos de caràcters** | `Reader` / `Writer`            | Caràcter (Unicode, 16 bits) | Textos humans: `.txt`, `.csv`, `.xml`           |

---

# FLUXOS DE BYTES

*(Totes les classes deriven d’`InputStream` i `OutputStream`)*

Els **fluxos de bytes** treballen amb informació en brut: seqüències de **0 i 1** sense interpretació com a text.
Són ideals per a:

* Fitxers binaris (imatges, vídeos, PDF).
* Fitxers de dades estructurades en binari.
* Quan volem **copiar** arxius sense preocupar-nos de la codificació.

---

## 1. Lectura binària (InputStream)

### 1.1 FileInputStream

Es sol usar per a llegir directament bytes d’un fitxer en disc.

**Constructors habituals:**

* `FileInputStream(String path)`
* `FileInputStream(File file)`

**Mètodes principals:**

* `int read()` → llig un byte i el retorna (0–255). Retorna -1 si arriba al final.
* `int read(byte[] b)` → llig diversos bytes en un array.
* `void close()` → tanca el flux.

**Exemple:** Llegir i mostrar el contingut binari d’un fitxer.

```java
FileInputStream fis = new FileInputStream("logo.png"); // Obrim el fitxer
int b;
while ((b = fis.read()) != -1) {       // Llegim byte a byte
    System.out.println(b);             // Mostrem el valor llegit
}
fis.close();                           // Tanquem el flux
```

---

### 1.2 BufferedInputStream

Esta classe serveix per millorar l’eficiència de la lectura, acumulant blocs de bytes en memòria.

**Constructor:**

* `BufferedInputStream(InputStream in)`

**Mètodes principals:**

* `int read()` / `int read(byte[] b)` → igual que `FileInputStream`, però més ràpid.
* `void close()`

**Exemple:** Llegir un fitxer gran amb buffer.

```java
BufferedInputStream bis =
    new BufferedInputStream(new FileInputStream("video.mp4"));
byte[] buf = new byte[4096];
int n;
while ((n = bis.read(buf)) != -1) {   // Llegim blocs de 4KB
    System.out.println("Llegits " + n + " bytes");
}
bis.close();
```

---

### 1.3 DataInputStream

S'utilitza per llegir **dades primitives** (`int`, `long`, `double`, `String`) guardades en format binari.

**Constructor:**

* `DataInputStream(InputStream in)`

**Mètodes principals:**

* `int readInt()` → llig un enter.
* `long readLong()` → llig un long.
* `double readDouble()` → llig un double.
* `String readUTF()` → llig una cadena en format UTF.
* `void close()`

**Exemple:** Llegir registres amb id, nom i nota.

```java
DataInputStream dis = new DataInputStream(
    new BufferedInputStream(new FileInputStream("notes.dat"))
);
int n = dis.readInt();                  // Primer llegim el nombre de registres
for (int i = 0; i < n; i++) {
    long id = dis.readLong();           // Llegim un id
    String nom = dis.readUTF();         // Llegim un nom
    double nota = dis.readDouble();     // Llegim una nota
    System.out.printf("%d %s %.2f%n", id, nom, nota);
}
dis.close();
```

---

## 2. Escriptura binària (OutputStream)

### 2.1 FileOutputStream

Esta classe serveix per escriure bytes en un fitxer.

**Constructors habituals:**

* `FileOutputStream(String path)` → sobreescriu el fitxer.
* `FileOutputStream(String path, boolean append)` → `append=true` afegeix al final.

**Mètodes principals:**

* `void write(int b)` → escriu un byte.
* `void write(byte[] b)` → escriu tot un array.
* `void flush()` → buida el buffer.
* `void close()`

**Exemple:** Escriure bytes en un fitxer.

```java
FileOutputStream fos = new FileOutputStream("dades.bin");
fos.write(new byte[]{10,20,30});   // Escriu l’array de bytes
fos.flush();                       // Assegura que es guarden al disc
fos.close();
```

---

### 2.2 BufferedOutputStream

Millorar l’eficiència escrivint blocs sencers en memòria abans de guardar-los al fitxer.

**Constructor:**

* `BufferedOutputStream(OutputStream out)`

**Mètodes principals:**

* `void write(byte[] b)` → escriu un bloc de bytes.
* `void flush()`
* `void close()`

**Exemple:** Escriure un bloc gran de dades.

```java
BufferedOutputStream bos =
    new BufferedOutputStream(new FileOutputStream("gran_sortida.bin"));
byte[] bloc = new byte[8192];     // Bloc de dades
bos.write(bloc);                  // Escriu tot el bloc
bos.flush();
bos.close();
```

---

### 2.3 DataOutputStream

S'utilitza per guardar dades primitives en format binari.

**Constructor:**

* `DataOutputStream(OutputStream out)`

**Mètodes principals:**

* `void writeInt(int v)`
* `void writeLong(long v)`
* `void writeDouble(double v)`
* `void writeUTF(String s)`
* `void flush()`
* `void close()`

**Exemple:** Guardar informació d’alumnes.

```java
DataOutputStream dos = new DataOutputStream(
    new BufferedOutputStream(new FileOutputStream("notes.dat"))
);
dos.writeInt(2);                  // Nombre de registres
dos.writeLong(1L); dos.writeUTF("Anna"); dos.writeDouble(9.5);
dos.writeLong(2L); dos.writeUTF("Marc"); dos.writeDouble(7.8);
dos.flush();
dos.close();
```

---

## 3. Combinacions habituals (binari)

* **Còpia d’un fitxer binari:**

```java
BufferedInputStream in = new BufferedInputStream(new FileInputStream("origen.jpg"));
BufferedOutputStream out = new BufferedOutputStream(new FileOutputStream("copia.jpg"));
byte[] buffer = new byte[1024];
int n;
while ((n = in.read(buffer)) != -1) {
    out.write(buffer, 0, n);
}
out.flush();
in.close();
out.close();
```

* **Fitxer de registres amb primitives:**

```java
DataOutputStream dos = new DataOutputStream(
    new BufferedOutputStream(new FileOutputStream("reg.dat"))
);
dos.writeInt(1);
dos.writeLong(101L); dos.writeUTF("Eva"); dos.writeDouble(9.1);
dos.flush(); dos.close();
```

---

## 4. Resum (fluxos de bytes)

| Classe                 | Finalitat                 | Exemple típic         |
| ---------------------- | ------------------------- | --------------------- |
| `FileInputStream`      | Llegir bytes d’un fitxer  | Obrir una imatge      |
| `BufferedInputStream`  | Lectura ràpida amb buffer | Vídeo gran            |
| `DataInputStream`      | Llegir primitives         | Fitxers `.dat`        |
| `FileOutputStream`     | Escriure bytes            | Guardar dades en brut |
| `BufferedOutputStream` | Escriure ràpid            | Arxius grans          |
| `DataOutputStream`     | Escriure primitives       | Guardar registres     |

---

# FLUXOS DE CARÀCTERS

*(Totes les classes deriven de `Reader` i `Writer`)*

Els **fluxos de caràcters** interpreten els bytes com a **text** amb una codificació (UTF-8, ISO...).
Són ideals per a:

* Fitxers `.txt`.
* Fitxers `.csv`, `.json`, `.xml`.
* Qualsevol informació destinada a humans.

---

## 1. Lectura de text (Reader)

### 1.1 FileReader

S'utilitza per llegir caràcters d’un fitxer amb el charset per defecte.

**Mètodes:**

* `int read()` → llig un caràcter.
* `int read(char[] cbuf)` → llig un bloc de caràcters.
* `void close()`

**Exemple (enunciat):** Llegir un text i mostrar-lo.

```java
FileReader fr = new FileReader("poema.txt");
char[] buf = new char[256];
int n;
while ((n = fr.read(buf)) != -1) {
    System.out.print(new String(buf, 0, n));
}
fr.close();
```

---

### 1.2 BufferedReader

S'utilitza per llegir línies completes amb `readLine()`.

**Mètodes:**

* `String readLine()` → llig una línia sencera.
* `void close()`

**Exemple (enunciat):** Llegir un fitxer línia a línia.

```java
BufferedReader br = new BufferedReader(new FileReader("entrada.txt"));
String linia;
while ((linia = br.readLine()) != null) {
    System.out.println(linia);
}
br.close();
```

---

### 1.3 InputStreamReader

S'utilitza per llegir bytes i convertir-los en caràcters amb un **charset específic**.

**Mètodes:**

* `int read()`
* `boolean ready()` → indica si hi ha dades disponibles.
* `void close()`

**Exemple (enunciat):** Llegir un fitxer en UTF-8.

```java
BufferedReader br = new BufferedReader(
    new InputStreamReader(new FileInputStream("text_utf8.txt"), "UTF-8")
);
String linia;
while ((linia = br.readLine()) != null) {
    System.out.println(linia);
}
br.close();
```

---

## 2. Escriptura de text (Writer)

### 2.1 FileWriter

S'utilitza per escriure caràcters en un fitxer.

**Mètodes:**

* `void write(String s)`
* `void flush()`
* `void close()`

**Exemple (enunciat):** Escriure un missatge en un fitxer.

```java
FileWriter fw = new FileWriter("nota.txt");
fw.write("Hola món");
fw.flush();
fw.close();
```

---

### 2.2 BufferedWriter

S'utilitza per escriure línies completes amb `newLine()`.

**Mètodes:**

* `void write(String s)`
* `void newLine()` → escriu un salt de línia.
* `void flush()`
* `void close()`

**Exemple (enunciat):** Escriure diverses línies.

```java
BufferedWriter bw = new BufferedWriter(new FileWriter("sortida.txt"));
bw.write("Primera línia");
bw.newLine();
bw.write("Segona línia");
bw.flush();
bw.close();
```

---

### 2.3 OutputStreamWriter

S'utilitza per convertir caràcters a bytes amb un charset concret.

**Mètodes:**

* `void write(String s)`
* `void flush()`
* `void close()`

**Exemple (enunciat):** Escriure text en UTF-8.

```java
OutputStreamWriter osw =
    new OutputStreamWriter(new FileOutputStream("resum.txt"), "UTF-8");
osw.write("Accents i caràcters: informació, valència");
osw.flush();
osw.close();
```

---

### 2.4 PrintWriter

S'utilitza per escriure text amb `print()`, `println()` i `printf()`.

**Mètodes:**

* `void print(String s)`
* `void println(String s)`
* `PrintWriter printf(String fmt, Object... args)`
* `void flush()`
* `void close()`

**Exemple (enunciat):** Escriure una taula amb format.

```java
PrintWriter pw = new PrintWriter(new BufferedWriter(new FileWriter("informe.txt")));
pw.println("ID\tNom\tNota");
pw.printf("%d\t%s\t%.2f%n", 1, "Anna", 9.25);
pw.printf("%d\t%s\t%.2f%n", 2, "Marc", 7.80);
pw.flush();
pw.close();
```

---

## 3. Combinacions habituals (text)

* **Lectura simple:**
  `BufferedReader + FileReader` → llegir línies fàcilment.

* **Lectura amb charset:**
  `BufferedReader + InputStreamReader + FileInputStream` → assegurar UTF-8.

* **Escriptura simple:**
  `BufferedWriter + FileWriter` → escriure línies amb `newLine()`.

* **Escriptura amb charset:**
  `BufferedWriter + OutputStreamWriter + FileOutputStream` → escriure UTF-8.

* **Escriptura amb format:**
  `PrintWriter + BufferedWriter + FileWriter` → informes amb `printf()`.

---

## 4. Resum (fluxos de caràcters)

| Classe               | Finalitat            | Exemple típic      |
| -------------------- | -------------------- | ------------------ |
| `FileReader`         | Llegir caràcters     | Llibre de text     |
| `BufferedReader`     | Llegir línies        | Fitxer `.txt`      |
| `InputStreamReader`  | Llegir amb charset   | Fitxer UTF-8       |
| `FileWriter`         | Escriure text        | Nota simple        |
| `BufferedWriter`     | Escriure línies      | Informe            |
| `OutputStreamWriter` | Escriure amb charset | Text internacional |
| `PrintWriter`        | Escriure amb format  | Informe amb taules |

---

# En resum:

* Els **fluxos de bytes** (`InputStream`/`OutputStream`) → per a dades binàries.
* Els **fluxos de caràcters** (`Reader`/`Writer`) → per a textos humans.
* Els **buffers** (`Buffered*`) → milloren l’eficiència.
* Els **Data\*Stream** → treballen amb primitives binàries.
* Els **StreamReader/Writer** → converteixen entre bytes i caràcters amb control de charset.
* Els **PrintWriter** → faciliten l’escriptura de text amb format.


