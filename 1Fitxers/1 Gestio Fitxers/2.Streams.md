---
title:  Streams
parent: 1.- Gesti√≥ del Sistema de Fitxers
grand_parent: Persist√®ncia de Fitxers
has_children: true
layout: default
nav_order: 20
---



# Fluxos de Dades (Streams) en Java

---

## Introducci√≥

Quan un programa necessita **comunicar-se amb l‚Äôexterior** (llegir un fitxer, escriure un informe, rebre dades d‚ÄôInternet o enviar informaci√≥ a la consola), necessita un **flux de dades (stream)**.

Un **flux** √©s un **cam√≠ seq√ºencial** pel qual les dades entren (entrada) o ixen (eixida) del programa.

**Passos b√†sics en qualsevol flux:**

1. **Obrir** el flux (crear l‚Äôobjecte adequat).
2. **Usar** el flux (llegir o escriure).
3. **Tancar** amb `close()` per alliberar recursos.

### Dos grans fam√≠lies de fluxos

| Fam√≠lia                 | Classe base                    | Unitat de treball           | √ös                                              |
| ----------------------- | ------------------------------ | --------------------------- | ----------------------------------------------- |
| **Fluxos de bytes**     | `InputStream` / `OutputStream` | Byte (8 bits)               | Dades bin√†ries: imatges, v√≠deos, fitxers `.exe` |
| **Fluxos de car√†cters** | `Reader` / `Writer`            | Car√†cter (Unicode, 16 bits) | Textos humans: `.txt`, `.csv`, `.xml`           |

---

## Bones pr√†ctiques generals

* **Tanca sempre els fluxos.** Usa `try-with-resources`, que els tanca autom√†ticament:

  ```java
  try (FileInputStream fis = new FileInputStream("fitxer.bin")) {
      // √∫s
  } // es tanca sol encara que hi haja excepcions
  ```

* **Gesti√≥ d‚Äôexcepcions habituals:**

  * `FileNotFoundException`: el fitxer no existeix o no tens permisos.
  * `EOFException`: lectura m√©s enll√† del final (sobretot amb `DataInputStream`).
  * `IOException`: errors generals d‚Äôentrada/eixida.

* **`flush()`**: nom√©s t√© sentit en escriptura; for√ßa a guardar el buffer al disc. Nota: `close()` ja fa `flush()`.

* **Ordre en fluxos encadenats:** si uses `new DataInputStream(new BufferedInputStream(...))`, tanques nom√©s el de fora (`dis.close()`), i tots els altres es tanquen autom√†ticament.

---

# FLUXOS DE BYTES

*(Totes les classes deriven d‚Äô`InputStream` i `OutputStream`)*

Els fluxos de bytes treballen amb dades **bin√†ries pures**. No interpreten res com a text.

S√≥n ideals per a:

* Imatges, v√≠deos, PDF.
* Fitxers `.dat` amb dades primitives.
* C√≤pia d‚Äôarxius byte a byte.

---

## 1. Lectura bin√†ria (InputStream)

### 1.1 FileInputStream

**Finalitat:** llegir directament bytes d‚Äôun fitxer.

**Constructors habituals:**

* `FileInputStream(String path)`
* `FileInputStream(File file)`

**M√®todes principals:**

* `int read()`: llig un byte (0‚Äì255). Retorna -1 si arriba al final.
* `int read(byte[] b)`: llig diversos bytes en un array.
* `void close()`: tanca el flux.

**Quan triar-la:** quan necessites llegir dades bin√†ries simples.
**Quan evitar-la:** per a fitxers grans ‚Üí millor embolicar amb `BufferedInputStream`.

**Exemple:** Llegir i mostrar els bytes d‚Äôun fitxer.

```java
try (FileInputStream fis = new FileInputStream("logo.png")) {
    int b;
    while ((b = fis.read()) != -1) {    // read() ‚Üí byte a byte
        System.out.println(b);
    }
}
```

---

### 1.2 BufferedInputStream

**Finalitat:** millorar la velocitat de lectura, acumulant blocs de bytes en mem√≤ria.

**Constructor:**

* `BufferedInputStream(InputStream in)`

**M√®todes principals:**

* `int read()` / `int read(byte[] b)`: lectura m√©s r√†pida que `FileInputStream`.
* `void mark(int limit)`: marca una posici√≥ per poder tornar despr√©s.
* `void reset()`: torna a la posici√≥ marcada.
* `boolean markSupported()`: indica si es pot usar `mark/reset`.
* `void close()`.

**Quan triar-la:** fitxers grans, lectures repetides.
**Quan evitar-la:** fitxers menuts (no aporta gaire).

**Exemple:** Llegir un fitxer gran amb buffer.

```java
try (BufferedInputStream bis =
         new BufferedInputStream(new FileInputStream("video.mp4"))) {
    byte[] buf = new byte[4096];
    int n;
    while ((n = bis.read(buf)) != -1) {
        System.out.println("Llegits " + n + " bytes");
    }
}
```

---

### 1.3 DataInputStream

**Finalitat:** llegir dades primitives (int, long, double, String) guardades en binari.

**Constructor:**

* `DataInputStream(InputStream in)`

**M√®todes principals:**

* `int readInt()`, `long readLong()`, `double readDouble()`: lligen primitives.
* `String readUTF()`: llig una cadena (nom√©s compatible amb `writeUTF()`).
* `void close()`.

**Quan triar-la:** per a fitxers `.dat` amb registres estructurats.
**Quan evitar-la:** quan no controles l‚Äôordre d‚Äôescriptura.

**Nota:** L‚Äôordre d‚Äôescriptura i lectura ha de coincidir exactament.

**Exemple:** Llegir registres d‚Äôalumnes.

```java
try (DataInputStream dis = new DataInputStream(
         new BufferedInputStream(new FileInputStream("notes.dat")))) {
    int n = dis.readInt();                  // primer el nombre de registres
    for (int i = 0; i < n; i++) {
        long id = dis.readLong();
        String nom = dis.readUTF();
        double nota = dis.readDouble();
        System.out.printf("%d %s %.2f%n", id, nom, nota);
    }
}
```

---

## 2. Escriptura bin√†ria (OutputStream)

### 2.1 FileOutputStream

**Finalitat:** escriure bytes en un fitxer.

**Constructors habituals:**

* `FileOutputStream(String path)` ‚Üí sobreescriu.
* `FileOutputStream(String path, boolean append)` ‚Üí si `true`, afegeix.

**M√®todes principals:**

* `void write(int b)`: escriu un byte.
* `void write(byte[] b)`: escriu un array sencer.
* `void write(byte[] b, int off, int len)`: escriu nom√©s una part.
* `void flush()`: buida el buffer.
* `void close()`.

**Quan triar-la:** per escriure dades bin√†ries simples.
**Quan evitar-la:** fitxers grans sense buffer.

**Exemple:** Escriure bytes en un fitxer.

```java
try (FileOutputStream fos = new FileOutputStream("dades.bin")) {
    fos.write(new byte[]{10,20,30});
}
```

---

### 2.2 BufferedOutputStream

**Finalitat:** millorar l‚Äôefici√®ncia escrivint en blocs.

**Constructor:**

* `BufferedOutputStream(OutputStream out)`

**M√®todes principals:**

* `void write(byte[] b)`
* `void flush()`
* `void close()`

**Quan triar-la:** arxius grans, moltes escriptures petites.

**Exemple:** Escriure un bloc gran.

```java
try (BufferedOutputStream bos =
         new BufferedOutputStream(new FileOutputStream("gran_sortida.bin"))) {
    byte[] bloc = new byte[8192];
    bos.write(bloc);
}
```

---

### 2.3 DataOutputStream

**Finalitat:** guardar dades primitives en binari.

**Constructor:**

* `DataOutputStream(OutputStream out)`

**M√®todes principals:**

* `void writeInt(int v)`, `void writeLong(long v)`, `void writeDouble(double v)`
* `void writeUTF(String s)`
* `void flush()`, `void close()`

**Quan triar-la:** quan vols guardar registres amb camps de tipus primitiu.
**Quan evitar-la:** si necessites compatibilitat amb altres llenguatges sense adaptar el format.

**Exemple:** Guardar alumnes.

```java
try (DataOutputStream dos = new DataOutputStream(
         new BufferedOutputStream(new FileOutputStream("notes.dat")))) {
    dos.writeInt(2);
    dos.writeLong(1L); dos.writeUTF("Anna"); dos.writeDouble(9.5);
    dos.writeLong(2L); dos.writeUTF("Marc"); dos.writeDouble(7.8);
}
```

---

## 3. Combinacions habituals (binari)

* **C√≤pia d‚Äôun fitxer binari:**

```java
try (BufferedInputStream in = new BufferedInputStream(new FileInputStream("origen.jpg"));
     BufferedOutputStream out = new BufferedOutputStream(new FileOutputStream("copia.jpg"))) {
    byte[] buffer = new byte[1024];
    int n;
    while ((n = in.read(buffer)) != -1) {
        out.write(buffer, 0, n);
    }
}
```

* **Fitxer de registres amb primitives:**

```java
try (DataOutputStream dos = new DataOutputStream(
         new BufferedOutputStream(new FileOutputStream("reg.dat")))) {
    dos.writeInt(1);
    dos.writeLong(101L); dos.writeUTF("Eva"); dos.writeDouble(9.1);
}
```

---

## 4. Resum (fluxos de bytes)

| Classe                 | Finalitat           | Quan triar-la          | Risc t√≠pic                  |
| ---------------------- | ------------------- | ---------------------- | --------------------------- |
| `FileInputStream`      | Llegir bytes        | Lectura senzilla       | Lent sense buffer           |
| `BufferedInputStream`  | Lectura r√†pida      | Fitxers grans          | ‚Äî                           |
| `DataInputStream`      | Llegir primitives   | Fitxers `.dat`         | Error si no respectes ordre |
| `FileOutputStream`     | Escriure bytes      | Escriure dades simples | Lent sense buffer           |
| `BufferedOutputStream` | Escriure r√†pid      | Fitxers grans          | Oblidar `flush()`           |
| `DataOutputStream`     | Escriure primitives | Fitxers `.dat`         | Ordre estricte              |

---

# FLUXOS DE CAR√ÄCTERS

*(Totes les classes deriven de `Reader` i `Writer`)*

Els fluxos de car√†cters interpreten els bytes com a **text**, segons un **charset** (UTF-8, ISO-8859-1...).

S√≥n ideals per a:

* Fitxers `.txt`, `.csv`, `.xml`, `.json`.
* Qualsevol informaci√≥ llegible per humans.

---

## ‚ö†Ô∏è Nota important sobre FileReader/FileWriter

Les classes `FileReader` i `FileWriter` **usen el charset per defecte del sistema**. Aix√≤ pot provocar errors amb accents i s√≠mbols.
**Recomanaci√≥:** si vols compatibilitat, usa `InputStreamReader`/`OutputStreamWriter` amb `StandardCharsets.UTF_8`.

---

## 1. Lectura de text (Reader)

### 1.1 FileReader

**Finalitat:** llegir car√†cters amb charset del sistema.
**M√®todes:**

* `int read()`, `int read(char[] cbuf)`, `void close()`

**Exemple:**

```java
try (FileReader fr = new FileReader("poema.txt")) {
    char[] buf = new char[256];
    int n;
    while ((n = fr.read(buf)) != -1) {
        System.out.print(new String(buf, 0, n));
    }
}
```

---

### 1.2 BufferedReader

**Finalitat:** llegir l√≠nies senceres amb `readLine()`.
**M√®todes:**

* `String readLine()`, `void close()`

**Exemple:**

```java
try (BufferedReader br = new BufferedReader(new FileReader("entrada.txt"))) {
    String linia;
    while ((linia = br.readLine()) != null) {
        System.out.p30rintln(linia);
    }
}
```

---

### 1.3 InputStreamReader

**Finalitat:** convertir bytes en car√†cters amb un charset.
**M√®todes:**

* `int read()`, `boolean ready()`, `void close()`

**Exemple:**

```java
try (BufferedReader br = new BufferedReader(
         new InputStreamReader(new FileInputStream("text_utf8.txt"), StandardCharsets.UTF_8))) {
    String linia;
    while ((linia = br.readLine()) != null) {
        System.out.println(linia);
    }
}
```

---

## 2. Escriptura de text (Writer)

### 2.1 FileWriter

**Finalitat:** escriure car√†cters amb charset del sistema.
**M√®todes:** `write(String)`, `flush()`, `close()`

**Exemple:**

```java
try (FileWriter fw = new FileWriter("nota.txt")) {
    fw.write("Hola m√≥n");
}
```

---

### 2.2 BufferedWriter

**Finalitat:** escriure l√≠nies amb `newLine()`.
**M√®todes:** `write(String)`, `newLine()`, `flush()`, `close()`

**Exemple:**

```java
try (BufferedWriter bw = new BufferedWriter(new FileWriter("sortida.txt"))) {
    bw.write("Primera l√≠nia");
    bw.newLine();
    bw.write("Segona l√≠nia");
}
```

---

### 2.3 OutputStreamWriter

**Finalitat:** escriure text amb un charset concret.
**Exemple:**

```java
try (OutputStreamWriter osw =
         new OutputStreamWriter(new FileOutputStream("resum.txt"), StandardCharsets.UTF_8)) {
    osw.write("Accents i car√†cters: informaci√≥, val√®ncia");
}
```

---

### 2.4 PrintWriter

**Finalitat:** escriure text amb format (`print`, `println`, `printf`).
**M√®todes extra:** `checkError()`, `autoFlush`.

**Exemple:**

```java
try (PrintWriter pw = new PrintWriter(
         new BufferedWriter(new FileWriter("informe.txt")))) {
    pw.println("ID\tNom\tNota");
    pw.printf("%d\t%s\t%.2f%n", 1, "Anna", 9.25);
}
```

---

## 3. Combinacions habituals (text)

* **Lectura simple:** `BufferedReader + FileReader`
* **Lectura amb charset:** `BufferedReader + InputStreamReader + FileInputStream`
* **Escriptura simple:** `BufferedWriter + FileWriter`
* **Escriptura amb charset:** `BufferedWriter + OutputStreamWriter + FileOutputStream`
* **Escriptura amb format:** `PrintWriter + BufferedWriter + FileWriter`

---

## 4. Resum (fluxos de car√†cters)

| Classe               | Finalitat            | Quan triar-la       | Risc t√≠pic                           |
| -------------------- | -------------------- | ------------------- | ------------------------------------ |
| `FileReader`         | Llegir car√†cters     | Text local          | Charset per defecte                  |
| `BufferedReader`     | Llegir l√≠nies        | Fitxers `.txt`      | ‚Äî                                    |
| `InputStreamReader`  | Llegir amb charset   | UTF-8/ISO controlat | ‚Äî                                    |
| `FileWriter`         | Escriure text        | Notes r√†pides       | Charset per defecte                  |
| `BufferedWriter`     | Escriure l√≠nies      | Informes            | Oblidar `newLine()`                  |
| `OutputStreamWriter` | Escriure amb charset | Text internacional  | ‚Äî                                    |
| `PrintWriter`        | Escriure amb format  | Taules i informes   | No avisa errors (usa `checkError()`) |

---

# Streams est√†ndard

* **`System.in`**: entrada de consola (`InputStream`). Sol usar-se amb `InputStreamReader` i `BufferedReader` per llegir l√≠nies.
* **`System.out`**: sortida de consola (`PrintStream`), amb `print`/`println`.
* **`System.err`**: errors de consola.

---

# En resum:

* **Fluxos de bytes** (`InputStream`/`OutputStream`) ‚Üí dades bin√†ries.
* **Fluxos de car√†cters** (`Reader`/`Writer`) ‚Üí text.
* **Buffered**\* ‚Üí rendiment.
* **Data\*Stream** ‚Üí primitives bin√†ries.
* **StreamReader/Writer** ‚Üí control de charset.
* **PrintWriter** ‚Üí text amb format.
* **try-with-resources** i **gesti√≥ d‚Äôexcepcions** ‚Üí bones pr√†ctiques.

---




Perfecte üôå.
Ac√≠ tens la **versi√≥ resumida d‚Äôuna p√†gina** dels apunts, pensada com a **full r√†pid per a ex√†mens**.

---

# Resum: Fluxos de Dades en Java

---

## Fam√≠lies principals

| Fam√≠lia       | Classe base                    | Unitat                      | √ös                                        |
| ------------- | ------------------------------ | --------------------------- | ----------------------------------------- |
| **Bytes**     | `InputStream` / `OutputStream` | Byte (8 bits)               | Fitxers binaris (imatges, v√≠deos, `.exe`) |
| **Car√†cters** | `Reader` / `Writer`            | Car√†cter (16 bits, Unicode) | Fitxers de text (`.txt`, `.csv`, `.xml`)  |

---

## Bones pr√†ctiques

* Usa **`try-with-resources`** ‚Üí tanca autom√†ticament.
* **`flush()`** nom√©s t√© sentit en escriptura (aboca el buffer).
* **Data\*Stream** ‚Üí l‚Äôordre d‚Äôescriptura i lectura ha de coincidir.
* **Evita `FileReader/FileWriter`** si vols compatibilitat ‚Üí usa `InputStreamReader/OutputStreamWriter` amb `UTF-8`.

---

## Fluxos de Bytes (InputStream / OutputStream)

| Classe                 | Finalitat           | Quan triar-la           | Risc t√≠pic                  |
| ---------------------- | ------------------- | ----------------------- | --------------------------- |
| `FileInputStream`      | Llegir bytes        | Fitxers binaris simples | Lent sense buffer           |
| `BufferedInputStream`  | Lectura r√†pida      | Fitxers grans           | ‚Äî                           |
| `DataInputStream`      | Llegir primitives   | Fitxers `.dat`          | Error si no respectes ordre |
| `FileOutputStream`     | Escriure bytes      | Guardar dades simples   | Lent sense buffer           |
| `BufferedOutputStream` | Escriure r√†pid      | Fitxers grans           | Oblidar `flush()`           |
| `DataOutputStream`     | Escriure primitives | Fitxers `.dat`          | Ordre estricte              |

---

## Fluxos de Car√†cters (Reader / Writer)

| Classe               | Finalitat            | Quan triar-la      | Risc t√≠pic          |
| -------------------- | -------------------- | ------------------ | ------------------- |
| `FileReader`         | Llegir car√†cters     | Text local senzill | Charset del sistema |
| `BufferedReader`     | Llegir l√≠nies        | Fitxers `.txt`     | ‚Äî                   |
| `InputStreamReader`  | Llegir amb charset   | Text internacional | ‚Äî                   |
| `FileWriter`         | Escriure car√†cters   | Notes r√†pides      | Charset del sistema |
| `BufferedWriter`     | Escriure l√≠nies      | Informes           | Oblidar `newLine()` |
| `OutputStreamWriter` | Escriure amb charset | Text UTF-8 segur   | ‚Äî                   |
| `PrintWriter`        | Escriure amb format  | Taules/informes    | No avisa errors     |

---

## Combinacions habituals

| Combinaci√≥                                                | Objectiu                 | Notes                      |
| --------------------------------------------------------- | ------------------------ | -------------------------- |
| `BufferedInputStream + FileInputStream`                   | Llegir binari r√†pid      | Fitxers grans              |
| `DataInputStream + BufferedInputStream + FileInputStream` | Llegir primitives        | Ordre estricte             |
| `BufferedReader + FileReader`                             | Llegir l√≠nies            | Nom√©s text local           |
| `BufferedReader + InputStreamReader + FileInputStream`    | Llegir l√≠nies amb UTF-8  | Evita problemes de charset |
| `BufferedWriter + FileWriter`                             | Escriure l√≠nies          | R√†pid i simple             |
| `BufferedWriter + OutputStreamWriter + FileOutputStream`  | Escriure l√≠nies en UTF-8 | Recomanat                  |
| `PrintWriter + BufferedWriter + FileWriter`               | Escriure amb format      | `printf()` i `println()`   |

---

## Streams est√†ndard

* **`System.in`** ‚Üí entrada consola (`InputStream`).
* **`System.out`** ‚Üí eixida consola (`PrintStream`).
* **`System.err`** ‚Üí errors consola.

---

## En una frase:

* **Bytes** ‚Üí binari.
* **Car√†cters** ‚Üí text.
* **Buffered**\* ‚Üí rendiment.
* **Data\*Stream** ‚Üí primitives bin√†ries.
* **Reader/Writer amb charset** ‚Üí text segur.
* **PrintWriter** ‚Üí informes amb format.

---

Vols que et prepare tamb√© una **versi√≥ tipus ‚Äúchuleta visual‚Äù** (esquemes i fletxes entre classes, sense text llarg), per a tindre-ho com un mapa conceptual r√†pid?
