---
title:  Classe File
parent: Streams
grand_parent: Persist√®ncia de Fitxers
has_children: true
layout: default
nav_order: 20
---


# Fluxos de Dades (Streams) en Java

---

## Introducci√≥

Quan un programa necessita **comunicar-se amb l‚Äôexterior** (llegir un fitxer, escriure un informe, rebre dades d‚ÄôInternet o enviar informaci√≥ a la consola), necessita un **flux de dades (stream)**.

Un **flux** √©s un **cam√≠ seq√ºencial** pel qual les dades entren (entrada) o ixen (eixida) del programa.

**Passos b√†sics en qualsevol flux:**

1. **Obrir** el flux (crear l‚Äôobjecte adequat).
2. **Usar** el flux (llegir o escriure).
3. **Tancar** amb `close()` per alliberar recursos.

### Dos grans fam√≠lies de fluxos

| Fam√≠lia                 | Classe base                    | Unitat de treball           | √ös                                              |
| ----------------------- | ------------------------------ | --------------------------- | ----------------------------------------------- |
| **Fluxos de bytes**     | `InputStream` / `OutputStream` | Byte (8 bits)               | Dades bin√†ries: imatges, v√≠deos, fitxers `.exe` |
| **Fluxos de car√†cters** | `Reader` / `Writer`            | Car√†cter (Unicode, 16 bits) | Textos humans: `.txt`, `.csv`, `.xml`           |

---

## Bones pr√†ctiques generals

* **Tanca sempre els fluxos.** Usa `try-with-resources`, que els tanca autom√†ticament:

  ```java
  try (FileInputStream fis = new FileInputStream("fitxer.bin")) {
      // √∫s
  } // es tanca sol encara que hi haja excepcions
  ```

* **Gesti√≥ d‚Äôexcepcions habituals:**

  * `FileNotFoundException`: el fitxer no existeix o no tens permisos.
  * `EOFException`: lectura m√©s enll√† del final (sobretot amb `DataInputStream`).
  * `IOException`: errors generals d‚Äôentrada/eixida.

* **`flush()`**: nom√©s t√© sentit en escriptura; for√ßa a guardar el buffer al disc. Nota: `close()` ja fa `flush()`.

* **Ordre en fluxos encadenats:** si uses `new DataInputStream(new BufferedInputStream(...))`, tanques nom√©s el de fora (`dis.close()`), i tots els altres es tanquen autom√†ticament.

* **Rendiment i mida del buffer:** normalment 8 KB √©s un valor raonable; en fitxers molt grans pots pujar a 32 KB.

---

# FLUXOS DE BYTES

*(Totes les classes deriven d‚Äô`InputStream` i `OutputStream`)*

Els fluxos de bytes treballen amb dades **bin√†ries pures**. No interpreten res com a text.

S√≥n ideals per a:

* Imatges, v√≠deos, PDF.
* Fitxers `.dat` amb dades primitives.
* C√≤pia d‚Äôarxius byte a byte.

---

## 1. Lectura bin√†ria (InputStream)

### 1.1 FileInputStream

**Finalitat:** llegir directament bytes d‚Äôun fitxer.

**Constructors habituals:**

* `FileInputStream(String path)`
* `FileInputStream(File file)`

**M√®todes detallats:**

* `int read()` ‚Üí llig un byte (0‚Äì255). Retorna -1 si arriba al final.
* `int read(byte[] b)` / `read(byte[] b, int off, int len)` ‚Üí llig diversos bytes en un array.
* `long skip(long n)` ‚Üí intenta saltar `n` bytes.
* `int available()` ‚Üí bytes que es poden llegir sense bloquejar.
* `void close()` ‚Üí tanca el flux.

**Quan triar-la:** per a lectures bin√†ries senzilles.
**Quan evitar-la:** per a fitxers grans (millor `BufferedInputStream`).

**Exemple:** llegir i mostrar bytes.

```java
try (FileInputStream fis = new FileInputStream("logo.png")) {
    int b;
    while ((b = fis.read()) != -1) {      // llegim byte a byte
        System.out.println(b);            // mostrem el valor
    }
}
```

---

### 1.2 BufferedInputStream

**Finalitat:** millorar la velocitat de lectura amb un buffer intern.

**Constructor:**

* `BufferedInputStream(InputStream in)`

**M√®todes detallats:**

* `int read()` / `read(byte[] b)` ‚Üí lectura amortitzada amb buffer.
* `mark(int limit)` ‚Üí marca la posici√≥ actual.
* `reset()` ‚Üí torna a la posici√≥ marcada.
* `boolean markSupported()` ‚Üí diu si suporta `mark/reset` (ac√≠ √©s true).
* `close()` ‚Üí tanca.

**Quan triar-la:** fitxers grans, lectures repetides.
**Quan evitar-la:** fitxers menuts.

**Exemple:** llegir amb buffer.

```java
try (BufferedInputStream bis =
         new BufferedInputStream(new FileInputStream("video.mp4"))) {
    byte[] buf = new byte[4096];
    int n;
    while ((n = bis.read(buf)) != -1) {
        System.out.println("Llegits " + n + " bytes");
    }
}
```

---

### 1.3 DataInputStream

**Finalitat:** llegir dades primitives (int, double, String) en format binari.

**Constructor:**

* `DataInputStream(InputStream in)`

**M√®todes detallats:**

* `readInt()`, `readLong()`, `readDouble()` ‚Üí lligen primitives.
* `readUTF()` ‚Üí llig una cadena (nom√©s compatible amb `writeUTF()`).
* `close()`.

**Quan triar-la:** per a fitxers `.dat` amb registres.
**Quan evitar-la:** quan no controles l‚Äôordre d‚Äôescriptura.

**Nota:** l‚Äôordre de lectura i escriptura ha de coincidir.

**Exemple:** llegir alumnes.

```java
try (DataInputStream dis = new DataInputStream(
         new BufferedInputStream(new FileInputStream("notes.dat")))) {
    int n = dis.readInt();
    for (int i = 0; i < n; i++) {
        long id = dis.readLong();
        String nom = dis.readUTF();
        double nota = dis.readDouble();
        System.out.printf("%d %s %.2f%n", id, nom, nota);
    }
}
```

---

## 2. Escriptura bin√†ria (OutputStream)

### 2.1 FileOutputStream

**Finalitat:** escriure bytes en un fitxer.

**Constructors habituals:**

* `FileOutputStream(String path)` ‚Üí sobreescriu.
* `FileOutputStream(String path, boolean append)` ‚Üí si true, afegeix.

**M√®todes detallats:**

* `write(int b)`, `write(byte[] b)`, `write(b, off, len)` ‚Üí escriu bytes.
* `flush()` ‚Üí aboca buffer.
* `close()`.

**Quan triar-la:** dades simples.
**Quan evitar-la:** sense buffer en fitxers grans.

**Exemple:** escriure bytes.

```java
try (FileOutputStream fos = new FileOutputStream("dades.bin")) {
    fos.write(new byte[]{10,20,30});
}
```

---

### 2.2 BufferedOutputStream

**Finalitat:** millorar l‚Äôefici√®ncia amb buffer.

**Constructor:**

* `BufferedOutputStream(OutputStream out)`

**M√®todes detallats:**

* `write(...)` ‚Üí escriu al buffer.
* `flush()` ‚Üí aboca immediatament.
* `close()` ‚Üí tanca.

**Exemple:** escriure bloc gran.

```java
try (BufferedOutputStream bos =
         new BufferedOutputStream(new FileOutputStream("gran_sortida.bin"))) {
    byte[] bloc = new byte[8192];
    bos.write(bloc);
}
```

---

### 2.3 DataOutputStream

**Finalitat:** escriure primitives en binari.

**Constructor:**

* `DataOutputStream(OutputStream out)`

**M√®todes detallats:**

* `writeInt(int v)`, `writeDouble(double v)`, `writeUTF(String s)`.
* `flush()`, `close()`.

**Quan triar-la:** guardar registres binaris.
**Quan evitar-la:** si necessites compatibilitat amb altres llenguatges.

**Exemple:** guardar alumnes.

```java
try (DataOutputStream dos = new DataOutputStream(
         new BufferedOutputStream(new FileOutputStream("notes.dat")))) {
    dos.writeInt(2);
    dos.writeLong(1L); dos.writeUTF("Anna"); dos.writeDouble(9.5);
    dos.writeLong(2L); dos.writeUTF("Marc"); dos.writeDouble(7.8);
}
```

---

## 3. Combinacions habituals (binari)

**C√≤pia d‚Äôun fitxer binari:**

```java
try (BufferedInputStream in = new BufferedInputStream(new FileInputStream("origen.jpg"));
     BufferedOutputStream out = new BufferedOutputStream(new FileOutputStream("copia.jpg"))) {
    byte[] buffer = new byte[1024];
    int n;
    while ((n = in.read(buffer)) != -1) {
        out.write(buffer, 0, n);
    }
}
```

**Fitxer de registres:**

```java
try (DataOutputStream dos = new DataOutputStream(
         new BufferedOutputStream(new FileOutputStream("reg.dat")))) {
    dos.writeInt(1);
    dos.writeLong(101L); dos.writeUTF("Eva"); dos.writeDouble(9.1);
}
```

---

# FLUXOS DE CAR√ÄCTERS

*(Totes les classes deriven de `Reader` i `Writer`)*

Els fluxos de car√†cters interpreten els bytes com a **text**, segons un **charset** (UTF-8, ISO...).

---

## ‚ö†Ô∏è Nota sobre FileReader/FileWriter

Aquestes classes usen **charset del sistema** ‚Üí pot fallar amb accents.

**Pitjor pr√†ctica:**

```java
FileReader fr = new FileReader("entrada.txt"); // dep√©n del sistema
```

**Millor pr√†ctica:**

```java
new InputStreamReader(new FileInputStream("entrada.txt"), StandardCharsets.UTF_8);
```

---

## 1. Lectura de text (Reader)

### 1.1 FileReader

**Finalitat:** llegir car√†cters amb charset del sistema.
**M√®todes detallats:** `read()`, `read(char[])`, `ready()`, `close()`.

**Exemple:**

```java
try (FileReader fr = new FileReader("poema.txt")) {
    char[] buf = new char[256];
    int n;
    while ((n = fr.read(buf)) != -1) {
        System.out.print(new String(buf, 0, n));
    }
}
```

---

### 1.2 BufferedReader

**Finalitat:** llegir l√≠nies amb `readLine()`.
**M√®todes detallats:** `readLine()`, `mark()`, `reset()`, `close()`.

**Exemple:**

```java
try (BufferedReader br = new BufferedReader(new FileReader("entrada.txt"))) {
    String linia;
    while ((linia = br.readLine()) != null) {
        System.out.println(linia);
    }
}
```

---

### 1.3 InputStreamReader

**Finalitat:** convertir bytes a car√†cters amb charset.
**M√®todes detallats:** `read()`, `ready()`, `getEncoding()`, `close()`.

**Exemple:**

```java
try (BufferedReader br = new BufferedReader(
         new InputStreamReader(new FileInputStream("text_utf8.txt"), StandardCharsets.UTF_8))) {
    String linia;
    while ((linia = br.readLine()) != null) {
        System.out.println(linia);
    }
}
```

---

## 2. Escriptura de text (Writer)

### 2.1 FileWriter

**Finalitat:** escriure car√†cters amb charset del sistema.
**M√®todes detallats:** `write(String)`, `flush()`, `close()`.

**Exemple:**

```java
try (FileWriter fw = new FileWriter("nota.txt")) {
    fw.write("Hola m√≥n");
}
```

---

### 2.2 BufferedWriter

**Finalitat:** escriure l√≠nies.
**M√®todes detallats:** `write()`, `newLine()`, `flush()`, `close()`.

**Exemple:**

```java
try (BufferedWriter bw = new BufferedWriter(new FileWriter("sortida.txt"))) {
    bw.write("Primera l√≠nia");
    bw.newLine();
    bw.write("Segona l√≠nia");
}
```

---

### 2.3 OutputStreamWriter

**Finalitat:** escriure text amb charset concret.
**M√®todes detallats:** `write()`, `getEncoding()`, `flush()`, `close()`.

**Exemple:**

```java
try (OutputStreamWriter osw =
         new OutputStreamWriter(new FileOutputStream("resum.txt"), StandardCharsets.UTF_8)) {
    osw.write("Accents i car√†cters: informaci√≥, val√®ncia");
}
```

---

### 2.4 PrintWriter

**Finalitat:** escriure amb format.
**M√®todes detallats:** `print()`, `println()`, `printf()`, `checkError()`, `flush()`, `close()`.

**Exemple:**

```java
try (PrintWriter pw = new PrintWriter(new BufferedWriter(new FileWriter("informe.txt")))) {
    pw.println("ID\tNom\tNota");
    pw.printf("%d\t%s\t%.2f%n", 1, "Anna", 9.25);
}
```

---

## 3. Combinacions habituals (text) amb exemples

**Lectura simple:**

```java
try (BufferedReader br = new BufferedReader(new FileReader("entrada.txt"))) {
    String linia;
    while ((linia = br.readLine()) != null) {
        System.out.println(linia);
    }
}
```

**Lectura amb charset:**

```java
try (BufferedReader br = new BufferedReader(
         new InputStreamReader(new FileInputStream("entrada.txt"), StandardCharsets.UTF_8))) {
    String linia;
    while ((linia = br.readLine()) != null) {
        System.out.println(linia);
    }
}
```

**Escriptura simple:**

```java
try (BufferedWriter bw = new BufferedWriter(new FileWriter("sortida.txt"))) {
    bw.write("Primera l√≠nia");
    bw.newLine();
    bw.write("Segona l√≠nia");
}
```

**Escriptura amb charset:**

```java
try (BufferedWriter bw = new BufferedWriter(
         new OutputStreamWriter(new FileOutputStream("sortida_utf8.txt"), StandardCharsets.UTF_8))) {
    bw.write("Accents: √†√®√≠√≤√∫ √ß √±");
}
```

**Escriptura amb format:**

```java
try (PrintWriter pw = new PrintWriter(new BufferedWriter(new FileWriter("informe.txt")))) {
    pw.printf("%d\t%s\t%.2f%n", 1, "Anna", 9.25);
    pw.printf("%d\t%s\t%.2f%n", 2, "Marc", 7.80);
}
```

---

# Streams est√†ndard

**`System.in`** ‚Üí entrada de consola (`InputStream`).
Exemple:

```java
try (BufferedReader br = new BufferedReader(new InputStreamReader(System.in))) {
    System.out.print("Introdueix el teu nom: ");
    String nom = br.readLine();
    System.out.println("Hola " + nom);
}
```

**`System.out`** ‚Üí sortida consola (`PrintStream`), amb `print`, `println`, `printf`.

**`System.err`** ‚Üí errors de consola.
Exemple:

```java
System.err.println("Error: fitxer no trobat");
```

---Ara tens un document **tancat i complet**.

---

Vols que et prepare tamb√© una **versi√≥ esquem√†tica redu√Øda amb nom√©s classes, m√®todes clau i exemples m√≠nims** (perqu√® l‚Äôalumnat tinga una ‚Äúchuleta‚Äù d‚Äôestudi r√†pid)?


# En resum

* **Fluxos de bytes** (`InputStream`/`OutputStream`) ‚Üí dades bin√†ries.
* **Fluxos de car√†cters** (`Reader`/`Writer`) ‚Üí text.
* **Buffered**\* ‚Üí rendiment.
* **Data\*Stream** ‚Üí primitives bin√†ries.
* **StreamReader/Writer** ‚Üí control de charset.
* **PrintWriter** ‚Üí text amb format.
* **try-with-resources** i **gesti√≥ d‚Äôexcepcions** ‚Üí bones pr√†ctiques.

---

# üìå Coses que faltaven en versions anteriors i ara s‚Äôhan afegit

1. **Llistats de m√®todes detallats** a cada classe (explicaci√≥ de qu√® fa cadascun).
2. **Exemples complets a combinacions (text)**, un per cada bullet.
3. **Explicaci√≥ clara de `flush()` i `close()` dins de cada classe.**
4. **Riscos t√≠pics** explicats dins de cada classe (no sols a les taules).
5. **Exemples comentats l√≠nia a l√≠nia** en moltes seccions.
6. **Banner + exemple comparatiu sobre FileReader/FileWriter vs InputStreamReader/OutputStreamWriter.**
7. **Nota sobre rendiment i mida de buffers.**
8. **Exemples pr√†ctics dels streams est√†ndard (`System.in`, `System.err`).**

