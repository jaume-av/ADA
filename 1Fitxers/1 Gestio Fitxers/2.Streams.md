---
title:  Streams
parent: 1.- Gestió del Sistema de Fitxers
grand_parent: Persistència de Fitxers
has_children: true
layout: default
nav_order: 20
---



# Fluxos de Dades (Streams) en Java

---

## Introducció

Quan un programa necessita **comunicar-se amb l’exterior** (llegir un fitxer, escriure un informe, rebre dades d’Internet o enviar informació a la consola), necessita un **flux de dades (stream)**.

Un **flux** és un **camí seqüencial** pel qual les dades entren (entrada) o ixen (eixida) del programa.

**Passos bàsics en qualsevol flux:**

1. **Obrir** el flux (crear l’objecte adequat).
2. **Usar** el flux (llegir o escriure).
3. **Tancar** amb `close()` per alliberar recursos.

### Dos grans famílies de fluxos

| Família                 | Classe base                    | Unitat de treball           | Ús                                              |
| ----------------------- | ------------------------------ | --------------------------- | ----------------------------------------------- |
| **Fluxos de bytes**     | `InputStream` / `OutputStream` | Byte (8 bits)               | Dades binàries: imatges, vídeos, fitxers `.exe` |
| **Fluxos de caràcters** | `Reader` / `Writer`            | Caràcter (Unicode, 16 bits) | Textos humans: `.txt`, `.csv`, `.xml`           |

---

## Bones pràctiques generals

* **Tanca sempre els fluxos.** Usa `try-with-resources`, que els tanca automàticament:

  ```java
  try (FileInputStream fis = new FileInputStream("fitxer.bin")) {
      // ús
  } // es tanca sol encara que hi haja excepcions
  ```

* **Gestió d’excepcions habituals:**

  * `FileNotFoundException`: el fitxer no existeix o no tens permisos.
  * `EOFException`: lectura més enllà del final (sobretot amb `DataInputStream`).
  * `IOException`: errors generals d’entrada/eixida.

* **`flush()`**: només té sentit en escriptura; força a guardar el buffer al disc. Nota: `close()` ja fa `flush()`.

* **Ordre en fluxos encadenats:** si uses `new DataInputStream(new BufferedInputStream(...))`, tanques només el de fora (`dis.close()`), i tots els altres es tanquen automàticament.

---

# FLUXOS DE BYTES

*(Totes les classes deriven d’`InputStream` i `OutputStream`)*

Els fluxos de bytes treballen amb dades **binàries pures**. No interpreten res com a text.

Són ideals per a:

* Imatges, vídeos, PDF.
* Fitxers `.dat` amb dades primitives.
* Còpia d’arxius byte a byte.

---

## 1. Lectura binària (InputStream)

### 1.1 FileInputStream

**Finalitat:** llegir directament bytes d’un fitxer.

**Constructors habituals:**

* `FileInputStream(String path)`
* `FileInputStream(File file)`

**Mètodes principals:**

* `int read()`: llig un byte (0–255). Retorna -1 si arriba al final.
* `int read(byte[] b)`: llig diversos bytes en un array.
* `void close()`: tanca el flux.

**Quan triar-la:** quan necessites llegir dades binàries simples.
**Quan evitar-la:** per a fitxers grans → millor embolicar amb `BufferedInputStream`.

**Exemple:** Llegir i mostrar els bytes d’un fitxer.

```java
try (FileInputStream fis = new FileInputStream("logo.png")) {
    int b;
    while ((b = fis.read()) != -1) {    // read() → byte a byte
        System.out.println(b);
    }
}
```

---

### 1.2 BufferedInputStream

**Finalitat:** millorar la velocitat de lectura, acumulant blocs de bytes en memòria.

**Constructor:**

* `BufferedInputStream(InputStream in)`

**Mètodes principals:**

* `int read()` / `int read(byte[] b)`: lectura més ràpida que `FileInputStream`.
* `void mark(int limit)`: marca una posició per poder tornar després.
* `void reset()`: torna a la posició marcada.
* `boolean markSupported()`: indica si es pot usar `mark/reset`.
* `void close()`.

**Quan triar-la:** fitxers grans, lectures repetides.
**Quan evitar-la:** fitxers menuts (no aporta gaire).

**Exemple:** Llegir un fitxer gran amb buffer.

```java
try (BufferedInputStream bis =
         new BufferedInputStream(new FileInputStream("video.mp4"))) {
    byte[] buf = new byte[4096];
    int n;
    while ((n = bis.read(buf)) != -1) {
        System.out.println("Llegits " + n + " bytes");
    }
}
```

---

### 1.3 DataInputStream

**Finalitat:** llegir dades primitives (int, long, double, String) guardades en binari.

**Constructor:**

* `DataInputStream(InputStream in)`

**Mètodes principals:**

* `int readInt()`, `long readLong()`, `double readDouble()`: lligen primitives.
* `String readUTF()`: llig una cadena (només compatible amb `writeUTF()`).
* `void close()`.

**Quan triar-la:** per a fitxers `.dat` amb registres estructurats.
**Quan evitar-la:** quan no controles l’ordre d’escriptura.

**Nota:** L’ordre d’escriptura i lectura ha de coincidir exactament.

**Exemple:** Llegir registres d’alumnes.

```java
try (DataInputStream dis = new DataInputStream(
         new BufferedInputStream(new FileInputStream("notes.dat")))) {
    int n = dis.readInt();                  // primer el nombre de registres
    for (int i = 0; i < n; i++) {
        long id = dis.readLong();
        String nom = dis.readUTF();
        double nota = dis.readDouble();
        System.out.printf("%d %s %.2f%n", id, nom, nota);
    }
}
```

---

## 2. Escriptura binària (OutputStream)

### 2.1 FileOutputStream

**Finalitat:** escriure bytes en un fitxer.

**Constructors habituals:**

* `FileOutputStream(String path)` → sobreescriu.
* `FileOutputStream(String path, boolean append)` → si `true`, afegeix.

**Mètodes principals:**

* `void write(int b)`: escriu un byte.
* `void write(byte[] b)`: escriu un array sencer.
* `void write(byte[] b, int off, int len)`: escriu només una part.
* `void flush()`: buida el buffer.
* `void close()`.

**Quan triar-la:** per escriure dades binàries simples.
**Quan evitar-la:** fitxers grans sense buffer.

**Exemple:** Escriure bytes en un fitxer.

```java
try (FileOutputStream fos = new FileOutputStream("dades.bin")) {
    fos.write(new byte[]{10,20,30});
}
```

---

### 2.2 BufferedOutputStream

**Finalitat:** millorar l’eficiència escrivint en blocs.

**Constructor:**

* `BufferedOutputStream(OutputStream out)`

**Mètodes principals:**

* `void write(byte[] b)`
* `void flush()`
* `void close()`

**Quan triar-la:** arxius grans, moltes escriptures petites.

**Exemple:** Escriure un bloc gran.

```java
try (BufferedOutputStream bos =
         new BufferedOutputStream(new FileOutputStream("gran_sortida.bin"))) {
    byte[] bloc = new byte[8192];
    bos.write(bloc);
}
```

---

### 2.3 DataOutputStream

**Finalitat:** guardar dades primitives en binari.

**Constructor:**

* `DataOutputStream(OutputStream out)`

**Mètodes principals:**

* `void writeInt(int v)`, `void writeLong(long v)`, `void writeDouble(double v)`
* `void writeUTF(String s)`
* `void flush()`, `void close()`

**Quan triar-la:** quan vols guardar registres amb camps de tipus primitiu.
**Quan evitar-la:** si necessites compatibilitat amb altres llenguatges sense adaptar el format.

**Exemple:** Guardar alumnes.

```java
try (DataOutputStream dos = new DataOutputStream(
         new BufferedOutputStream(new FileOutputStream("notes.dat")))) {
    dos.writeInt(2);
    dos.writeLong(1L); dos.writeUTF("Anna"); dos.writeDouble(9.5);
    dos.writeLong(2L); dos.writeUTF("Marc"); dos.writeDouble(7.8);
}
```

---

## 3. Combinacions habituals (binari)

* **Còpia d’un fitxer binari:**

```java
try (BufferedInputStream in = new BufferedInputStream(new FileInputStream("origen.jpg"));
     BufferedOutputStream out = new BufferedOutputStream(new FileOutputStream("copia.jpg"))) {
    byte[] buffer = new byte[1024];
    int n;
    while ((n = in.read(buffer)) != -1) {
        out.write(buffer, 0, n);
    }
}
```

* **Fitxer de registres amb primitives:**

```java
try (DataOutputStream dos = new DataOutputStream(
         new BufferedOutputStream(new FileOutputStream("reg.dat")))) {
    dos.writeInt(1);
    dos.writeLong(101L); dos.writeUTF("Eva"); dos.writeDouble(9.1);
}
```

---

## 4. Resum (fluxos de bytes)

| Classe                 | Finalitat           | Quan triar-la          | Risc típic                  |
| ---------------------- | ------------------- | ---------------------- | --------------------------- |
| `FileInputStream`      | Llegir bytes        | Lectura senzilla       | Lent sense buffer           |
| `BufferedInputStream`  | Lectura ràpida      | Fitxers grans          | —                           |
| `DataInputStream`      | Llegir primitives   | Fitxers `.dat`         | Error si no respectes ordre |
| `FileOutputStream`     | Escriure bytes      | Escriure dades simples | Lent sense buffer           |
| `BufferedOutputStream` | Escriure ràpid      | Fitxers grans          | Oblidar `flush()`           |
| `DataOutputStream`     | Escriure primitives | Fitxers `.dat`         | Ordre estricte              |

---

# FLUXOS DE CARÀCTERS

*(Totes les classes deriven de `Reader` i `Writer`)*

Els fluxos de caràcters interpreten els bytes com a **text**, segons un **charset** (UTF-8, ISO-8859-1...).

Són ideals per a:

* Fitxers `.txt`, `.csv`, `.xml`, `.json`.
* Qualsevol informació llegible per humans.

---

## ⚠️ Nota important sobre FileReader/FileWriter

Les classes `FileReader` i `FileWriter` **usen el charset per defecte del sistema**. Això pot provocar errors amb accents i símbols.
**Recomanació:** si vols compatibilitat, usa `InputStreamReader`/`OutputStreamWriter` amb `StandardCharsets.UTF_8`.

---

## 1. Lectura de text (Reader)

### 1.1 FileReader

**Finalitat:** llegir caràcters amb charset del sistema.
**Mètodes:**

* `int read()`, `int read(char[] cbuf)`, `void close()`

**Exemple:**

```java
try (FileReader fr = new FileReader("poema.txt")) {
    char[] buf = new char[256];
    int n;
    while ((n = fr.read(buf)) != -1) {
        System.out.print(new String(buf, 0, n));
    }
}
```

---

### 1.2 BufferedReader

**Finalitat:** llegir línies senceres amb `readLine()`.
**Mètodes:**

* `String readLine()`, `void close()`

**Exemple:**

```java
try (BufferedReader br = new BufferedReader(new FileReader("entrada.txt"))) {
    String linia;
    while ((linia = br.readLine()) != null) {
        System.out.p30rintln(linia);
    }
}
```

---

### 1.3 InputStreamReader

**Finalitat:** convertir bytes en caràcters amb un charset.
**Mètodes:**

* `int read()`, `boolean ready()`, `void close()`

**Exemple:**

```java
try (BufferedReader br = new BufferedReader(
         new InputStreamReader(new FileInputStream("text_utf8.txt"), StandardCharsets.UTF_8))) {
    String linia;
    while ((linia = br.readLine()) != null) {
        System.out.println(linia);
    }
}
```

---

## 2. Escriptura de text (Writer)

### 2.1 FileWriter

**Finalitat:** escriure caràcters amb charset del sistema.
**Mètodes:** `write(String)`, `flush()`, `close()`

**Exemple:**

```java
try (FileWriter fw = new FileWriter("nota.txt")) {
    fw.write("Hola món");
}
```

---

### 2.2 BufferedWriter

**Finalitat:** escriure línies amb `newLine()`.
**Mètodes:** `write(String)`, `newLine()`, `flush()`, `close()`

**Exemple:**

```java
try (BufferedWriter bw = new BufferedWriter(new FileWriter("sortida.txt"))) {
    bw.write("Primera línia");
    bw.newLine();
    bw.write("Segona línia");
}
```

---

### 2.3 OutputStreamWriter

**Finalitat:** escriure text amb un charset concret.
**Exemple:**

```java
try (OutputStreamWriter osw =
         new OutputStreamWriter(new FileOutputStream("resum.txt"), StandardCharsets.UTF_8)) {
    osw.write("Accents i caràcters: informació, valència");
}
```

---

### 2.4 PrintWriter

**Finalitat:** escriure text amb format (`print`, `println`, `printf`).
**Mètodes extra:** `checkError()`, `autoFlush`.

**Exemple:**

```java
try (PrintWriter pw = new PrintWriter(
         new BufferedWriter(new FileWriter("informe.txt")))) {
    pw.println("ID\tNom\tNota");
    pw.printf("%d\t%s\t%.2f%n", 1, "Anna", 9.25);
}
```

---

## 3. Combinacions habituals (text)

* **Lectura simple:** `BufferedReader + FileReader`
* **Lectura amb charset:** `BufferedReader + InputStreamReader + FileInputStream`
* **Escriptura simple:** `BufferedWriter + FileWriter`
* **Escriptura amb charset:** `BufferedWriter + OutputStreamWriter + FileOutputStream`
* **Escriptura amb format:** `PrintWriter + BufferedWriter + FileWriter`

---

## 4. Resum (fluxos de caràcters)

| Classe               | Finalitat            | Quan triar-la       | Risc típic                           |
| -------------------- | -------------------- | ------------------- | ------------------------------------ |
| `FileReader`         | Llegir caràcters     | Text local          | Charset per defecte                  |
| `BufferedReader`     | Llegir línies        | Fitxers `.txt`      | —                                    |
| `InputStreamReader`  | Llegir amb charset   | UTF-8/ISO controlat | —                                    |
| `FileWriter`         | Escriure text        | Notes ràpides       | Charset per defecte                  |
| `BufferedWriter`     | Escriure línies      | Informes            | Oblidar `newLine()`                  |
| `OutputStreamWriter` | Escriure amb charset | Text internacional  | —                                    |
| `PrintWriter`        | Escriure amb format  | Taules i informes   | No avisa errors (usa `checkError()`) |

---

# Streams estàndard

* **`System.in`**: entrada de consola (`InputStream`). Sol usar-se amb `InputStreamReader` i `BufferedReader` per llegir línies.
* **`System.out`**: sortida de consola (`PrintStream`), amb `print`/`println`.
* **`System.err`**: errors de consola.

---

# En resum:

* **Fluxos de bytes** (`InputStream`/`OutputStream`) → dades binàries.
* **Fluxos de caràcters** (`Reader`/`Writer`) → text.
* **Buffered**\* → rendiment.
* **Data\*Stream** → primitives binàries.
* **StreamReader/Writer** → control de charset.
* **PrintWriter** → text amb format.
* **try-with-resources** i **gestió d’excepcions** → bones pràctiques.



---

# Resum:

---

## Famílies principals

| Família       | Classe base                    | Unitat                      | Ús                                        |
| ------------- | ------------------------------ | --------------------------- | ----------------------------------------- |
| **Bytes**     | `InputStream` / `OutputStream` | Byte (8 bits)               | Fitxers binaris (imatges, vídeos, `.exe`) |
| **Caràcters** | `Reader` / `Writer`            | Caràcter (16 bits, Unicode) | Fitxers de text (`.txt`, `.csv`, `.xml`)  |

---

## Bones pràctiques

* Usa **`try-with-resources`** → tanca automàticament.
* **`flush()`** només té sentit en escriptura (aboca el buffer).
* **Data\*Stream** → l’ordre d’escriptura i lectura ha de coincidir.
* **Evita `FileReader/FileWriter`** si vols compatibilitat → usa `InputStreamReader/OutputStreamWriter` amb `UTF-8`.

---

## Fluxos de Bytes (InputStream / OutputStream)

| Classe                 | Finalitat           | Quan triar-la           | Risc típic                  |
| ---------------------- | ------------------- | ----------------------- | --------------------------- |
| `FileInputStream`      | Llegir bytes        | Fitxers binaris simples | Lent sense buffer           |
| `BufferedInputStream`  | Lectura ràpida      | Fitxers grans           | —                           |
| `DataInputStream`      | Llegir primitives   | Fitxers `.dat`          | Error si no respectes ordre |
| `FileOutputStream`     | Escriure bytes      | Guardar dades simples   | Lent sense buffer           |
| `BufferedOutputStream` | Escriure ràpid      | Fitxers grans           | Oblidar `flush()`           |
| `DataOutputStream`     | Escriure primitives | Fitxers `.dat`          | Ordre estricte              |

---

## Fluxos de Caràcters (Reader / Writer)

| Classe               | Finalitat            | Quan triar-la      | Risc típic          |
| -------------------- | -------------------- | ------------------ | ------------------- |
| `FileReader`         | Llegir caràcters     | Text local senzill | Charset del sistema |
| `BufferedReader`     | Llegir línies        | Fitxers `.txt`     | —                   |
| `InputStreamReader`  | Llegir amb charset   | Text internacional | —                   |
| `FileWriter`         | Escriure caràcters   | Notes ràpides      | Charset del sistema |
| `BufferedWriter`     | Escriure línies      | Informes           | Oblidar `newLine()` |
| `OutputStreamWriter` | Escriure amb charset | Text UTF-8 segur   | —                   |
| `PrintWriter`        | Escriure amb format  | Taules/informes    | No avisa errors     |

---

## Combinacions habituals

| Combinació                                                | Objectiu                 | Notes                      |
| --------------------------------------------------------- | ------------------------ | -------------------------- |
| `BufferedInputStream + FileInputStream`                   | Llegir binari ràpid      | Fitxers grans              |
| `DataInputStream + BufferedInputStream + FileInputStream` | Llegir primitives        | Ordre estricte             |
| `BufferedReader + FileReader`                             | Llegir línies            | Només text local           |
| `BufferedReader + InputStreamReader + FileInputStream`    | Llegir línies amb UTF-8  | Evita problemes de charset |
| `BufferedWriter + FileWriter`                             | Escriure línies          | Ràpid i simple             |
| `BufferedWriter + OutputStreamWriter + FileOutputStream`  | Escriure línies en UTF-8 | Recomanat                  |
| `PrintWriter + BufferedWriter + FileWriter`               | Escriure amb format      | `printf()` i `println()`   |

---

## Streams estàndard

* **`System.in`** → entrada consola (`InputStream`).
* **`System.out`** → eixida consola (`PrintStream`).
* **`System.err`** → errors consola.

---

## En una frase:

* **Bytes** → binari.
* **Caràcters** → text.
* **Buffered**\* → rendiment.
* **Data\*Stream** → primitives binàries.
* **Reader/Writer amb charset** → text segur.
* **PrintWriter** → informes amb format.

