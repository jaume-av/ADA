---
title:  Classe File
parent: Streams
grand_parent: Persistència de Fitxers
has_children: true
layout: default
nav_order: 20
---


# Fluxos de Dades (Streams) en Java

---

## Introducció

Quan un programa necessita **comunicar-se amb l’exterior** (llegir un fitxer, escriure un informe, rebre dades d’Internet o enviar informació a la consola), necessita un **flux de dades (stream)**.

Un **flux** és un **camí seqüencial** pel qual les dades entren (entrada) o ixen (eixida) del programa.

**Passos bàsics en qualsevol flux:**

1. **Obrir** el flux (crear l’objecte adequat).
2. **Usar** el flux (llegir o escriure).
3. **Tancar** amb `close()` per alliberar recursos.

### Dos grans famílies de fluxos

| Família                 | Classe base                    | Unitat de treball           | Ús                                              |
| ----------------------- | ------------------------------ | --------------------------- | ----------------------------------------------- |
| **Fluxos de bytes**     | `InputStream` / `OutputStream` | Byte (8 bits)               | Dades binàries: imatges, vídeos, fitxers `.exe` |
| **Fluxos de caràcters** | `Reader` / `Writer`            | Caràcter (Unicode, 16 bits) | Textos humans: `.txt`, `.csv`, `.xml`           |

---

## Bones pràctiques generals

* **Tanca sempre els fluxos.** Usa `try-with-resources`, que els tanca automàticament:

  ```java
  try (FileInputStream fis = new FileInputStream("fitxer.bin")) {
      // ús
  } // es tanca sol encara que hi haja excepcions
  ```

* **Gestió d’excepcions habituals:**

  * `FileNotFoundException`: el fitxer no existeix o no tens permisos.
  * `EOFException`: lectura més enllà del final (sobretot amb `DataInputStream`).
  * `IOException`: errors generals d’entrada/eixida.

* **`flush()`**: només té sentit en escriptura; força a guardar el buffer al disc. Nota: `close()` ja fa `flush()`.

* **Ordre en fluxos encadenats:** si uses `new DataInputStream(new BufferedInputStream(...))`, tanques només el de fora (`dis.close()`), i tots els altres es tanquen automàticament.

* **Rendiment i mida del buffer:** normalment 8 KB és un valor raonable; en fitxers molt grans pots pujar a 32 KB.

---

# FLUXOS DE BYTES

*(Totes les classes deriven d’`InputStream` i `OutputStream`)*

Els fluxos de bytes treballen amb dades **binàries pures**. No interpreten res com a text.

Són ideals per a:

* Imatges, vídeos, PDF.
* Fitxers `.dat` amb dades primitives.
* Còpia d’arxius byte a byte.

---

## 1. Lectura binària (InputStream)

### 1.1 FileInputStream

**Finalitat:** llegir directament bytes d’un fitxer.

**Constructors habituals:**

* `FileInputStream(String path)`
* `FileInputStream(File file)`

**Mètodes detallats:**

* `int read()` → llig un byte (0–255). Retorna -1 si arriba al final.
* `int read(byte[] b)` / `read(byte[] b, int off, int len)` → llig diversos bytes en un array.
* `long skip(long n)` → intenta saltar `n` bytes.
* `int available()` → bytes que es poden llegir sense bloquejar.
* `void close()` → tanca el flux.

**Quan triar-la:** per a lectures binàries senzilles.
**Quan evitar-la:** per a fitxers grans (millor `BufferedInputStream`).

**Exemple:** llegir i mostrar bytes.

```java
try (FileInputStream fis = new FileInputStream("logo.png")) {
    int b;
    while ((b = fis.read()) != -1) {      // llegim byte a byte
        System.out.println(b);            // mostrem el valor
    }
}
```

---

### 1.2 BufferedInputStream

**Finalitat:** millorar la velocitat de lectura amb un buffer intern.

**Constructor:**

* `BufferedInputStream(InputStream in)`

**Mètodes detallats:**

* `int read()` / `read(byte[] b)` → lectura amortitzada amb buffer.
* `mark(int limit)` → marca la posició actual.
* `reset()` → torna a la posició marcada.
* `boolean markSupported()` → diu si suporta `mark/reset` (ací és true).
* `close()` → tanca.

**Quan triar-la:** fitxers grans, lectures repetides.
**Quan evitar-la:** fitxers menuts.

**Exemple:** llegir amb buffer.

```java
try (BufferedInputStream bis =
         new BufferedInputStream(new FileInputStream("video.mp4"))) {
    byte[] buf = new byte[4096];
    int n;
    while ((n = bis.read(buf)) != -1) {
        System.out.println("Llegits " + n + " bytes");
    }
}
```

---

### 1.3 DataInputStream

**Finalitat:** llegir dades primitives (int, double, String) en format binari.

**Constructor:**

* `DataInputStream(InputStream in)`

**Mètodes detallats:**

* `readInt()`, `readLong()`, `readDouble()` → lligen primitives.
* `readUTF()` → llig una cadena (només compatible amb `writeUTF()`).
* `close()`.

**Quan triar-la:** per a fitxers `.dat` amb registres.
**Quan evitar-la:** quan no controles l’ordre d’escriptura.

**Nota:** l’ordre de lectura i escriptura ha de coincidir.

**Exemple:** llegir alumnes.

```java
try (DataInputStream dis = new DataInputStream(
         new BufferedInputStream(new FileInputStream("notes.dat")))) {
    int n = dis.readInt();
    for (int i = 0; i < n; i++) {
        long id = dis.readLong();
        String nom = dis.readUTF();
        double nota = dis.readDouble();
        System.out.printf("%d %s %.2f%n", id, nom, nota);
    }
}
```

---

## 2. Escriptura binària (OutputStream)

### 2.1 FileOutputStream

**Finalitat:** escriure bytes en un fitxer.

**Constructors habituals:**

* `FileOutputStream(String path)` → sobreescriu.
* `FileOutputStream(String path, boolean append)` → si true, afegeix.

**Mètodes detallats:**

* `write(int b)`, `write(byte[] b)`, `write(b, off, len)` → escriu bytes.
* `flush()` → aboca buffer.
* `close()`.

**Quan triar-la:** dades simples.
**Quan evitar-la:** sense buffer en fitxers grans.

**Exemple:** escriure bytes.

```java
try (FileOutputStream fos = new FileOutputStream("dades.bin")) {
    fos.write(new byte[]{10,20,30});
}
```

---

### 2.2 BufferedOutputStream

**Finalitat:** millorar l’eficiència amb buffer.

**Constructor:**

* `BufferedOutputStream(OutputStream out)`

**Mètodes detallats:**

* `write(...)` → escriu al buffer.
* `flush()` → aboca immediatament.
* `close()` → tanca.

**Exemple:** escriure bloc gran.

```java
try (BufferedOutputStream bos =
         new BufferedOutputStream(new FileOutputStream("gran_sortida.bin"))) {
    byte[] bloc = new byte[8192];
    bos.write(bloc);
}
```

---

### 2.3 DataOutputStream

**Finalitat:** escriure primitives en binari.

**Constructor:**

* `DataOutputStream(OutputStream out)`

**Mètodes detallats:**

* `writeInt(int v)`, `writeDouble(double v)`, `writeUTF(String s)`.
* `flush()`, `close()`.

**Quan triar-la:** guardar registres binaris.
**Quan evitar-la:** si necessites compatibilitat amb altres llenguatges.

**Exemple:** guardar alumnes.

```java
try (DataOutputStream dos = new DataOutputStream(
         new BufferedOutputStream(new FileOutputStream("notes.dat")))) {
    dos.writeInt(2);
    dos.writeLong(1L); dos.writeUTF("Anna"); dos.writeDouble(9.5);
    dos.writeLong(2L); dos.writeUTF("Marc"); dos.writeDouble(7.8);
}
```

---

## 3. Combinacions habituals (binari)

**Còpia d’un fitxer binari:**

```java
try (BufferedInputStream in = new BufferedInputStream(new FileInputStream("origen.jpg"));
     BufferedOutputStream out = new BufferedOutputStream(new FileOutputStream("copia.jpg"))) {
    byte[] buffer = new byte[1024];
    int n;
    while ((n = in.read(buffer)) != -1) {
        out.write(buffer, 0, n);
    }
}
```

**Fitxer de registres:**

```java
try (DataOutputStream dos = new DataOutputStream(
         new BufferedOutputStream(new FileOutputStream("reg.dat")))) {
    dos.writeInt(1);
    dos.writeLong(101L); dos.writeUTF("Eva"); dos.writeDouble(9.1);
}
```

---

# FLUXOS DE CARÀCTERS

*(Totes les classes deriven de `Reader` i `Writer`)*

Els fluxos de caràcters interpreten els bytes com a **text**, segons un **charset** (UTF-8, ISO...).

---

## ⚠️ Nota sobre FileReader/FileWriter

Aquestes classes usen **charset del sistema** → pot fallar amb accents.

**Pitjor pràctica:**

```java
FileReader fr = new FileReader("entrada.txt"); // depén del sistema
```

**Millor pràctica:**

```java
new InputStreamReader(new FileInputStream("entrada.txt"), StandardCharsets.UTF_8);
```

---

## 1. Lectura de text (Reader)

### 1.1 FileReader

**Finalitat:** llegir caràcters amb charset del sistema.
**Mètodes detallats:** `read()`, `read(char[])`, `ready()`, `close()`.

**Exemple:**

```java
try (FileReader fr = new FileReader("poema.txt")) {
    char[] buf = new char[256];
    int n;
    while ((n = fr.read(buf)) != -1) {
        System.out.print(new String(buf, 0, n));
    }
}
```

---

### 1.2 BufferedReader

**Finalitat:** llegir línies amb `readLine()`.
**Mètodes detallats:** `readLine()`, `mark()`, `reset()`, `close()`.

**Exemple:**

```java
try (BufferedReader br = new BufferedReader(new FileReader("entrada.txt"))) {
    String linia;
    while ((linia = br.readLine()) != null) {
        System.out.println(linia);
    }
}
```

---

### 1.3 InputStreamReader

**Finalitat:** convertir bytes a caràcters amb charset.
**Mètodes detallats:** `read()`, `ready()`, `getEncoding()`, `close()`.

**Exemple:**

```java
try (BufferedReader br = new BufferedReader(
         new InputStreamReader(new FileInputStream("text_utf8.txt"), StandardCharsets.UTF_8))) {
    String linia;
    while ((linia = br.readLine()) != null) {
        System.out.println(linia);
    }
}
```

---

## 2. Escriptura de text (Writer)

### 2.1 FileWriter

**Finalitat:** escriure caràcters amb charset del sistema.
**Mètodes detallats:** `write(String)`, `flush()`, `close()`.

**Exemple:**

```java
try (FileWriter fw = new FileWriter("nota.txt")) {
    fw.write("Hola món");
}
```

---

### 2.2 BufferedWriter

**Finalitat:** escriure línies.
**Mètodes detallats:** `write()`, `newLine()`, `flush()`, `close()`.

**Exemple:**

```java
try (BufferedWriter bw = new BufferedWriter(new FileWriter("sortida.txt"))) {
    bw.write("Primera línia");
    bw.newLine();
    bw.write("Segona línia");
}
```

---

### 2.3 OutputStreamWriter

**Finalitat:** escriure text amb charset concret.
**Mètodes detallats:** `write()`, `getEncoding()`, `flush()`, `close()`.

**Exemple:**

```java
try (OutputStreamWriter osw =
         new OutputStreamWriter(new FileOutputStream("resum.txt"), StandardCharsets.UTF_8)) {
    osw.write("Accents i caràcters: informació, valència");
}
```

---

### 2.4 PrintWriter

**Finalitat:** escriure amb format.
**Mètodes detallats:** `print()`, `println()`, `printf()`, `checkError()`, `flush()`, `close()`.

**Exemple:**

```java
try (PrintWriter pw = new PrintWriter(new BufferedWriter(new FileWriter("informe.txt")))) {
    pw.println("ID\tNom\tNota");
    pw.printf("%d\t%s\t%.2f%n", 1, "Anna", 9.25);
}
```

---

## 3. Combinacions habituals (text) amb exemples

**Lectura simple:**

```java
try (BufferedReader br = new BufferedReader(new FileReader("entrada.txt"))) {
    String linia;
    while ((linia = br.readLine()) != null) {
        System.out.println(linia);
    }
}
```

**Lectura amb charset:**

```java
try (BufferedReader br = new BufferedReader(
         new InputStreamReader(new FileInputStream("entrada.txt"), StandardCharsets.UTF_8))) {
    String linia;
    while ((linia = br.readLine()) != null) {
        System.out.println(linia);
    }
}
```

**Escriptura simple:**

```java
try (BufferedWriter bw = new BufferedWriter(new FileWriter("sortida.txt"))) {
    bw.write("Primera línia");
    bw.newLine();
    bw.write("Segona línia");
}
```

**Escriptura amb charset:**

```java
try (BufferedWriter bw = new BufferedWriter(
         new OutputStreamWriter(new FileOutputStream("sortida_utf8.txt"), StandardCharsets.UTF_8))) {
    bw.write("Accents: àèíòú ç ñ");
}
```

**Escriptura amb format:**

```java
try (PrintWriter pw = new PrintWriter(new BufferedWriter(new FileWriter("informe.txt")))) {
    pw.printf("%d\t%s\t%.2f%n", 1, "Anna", 9.25);
    pw.printf("%d\t%s\t%.2f%n", 2, "Marc", 7.80);
}
```

---

# Streams estàndard

**`System.in`** → entrada de consola (`InputStream`).
Exemple:

```java
try (BufferedReader br = new BufferedReader(new InputStreamReader(System.in))) {
    System.out.print("Introdueix el teu nom: ");
    String nom = br.readLine();
    System.out.println("Hola " + nom);
}
```

**`System.out`** → sortida consola (`PrintStream`), amb `print`, `println`, `printf`.

**`System.err`** → errors de consola.
Exemple:

```java
System.err.println("Error: fitxer no trobat");
```

---Ara tens un document **tancat i complet**.

---

Vols que et prepare també una **versió esquemàtica reduïda amb només classes, mètodes clau i exemples mínims** (perquè l’alumnat tinga una “chuleta” d’estudi ràpid)?


# En resum

* **Fluxos de bytes** (`InputStream`/`OutputStream`) → dades binàries.
* **Fluxos de caràcters** (`Reader`/`Writer`) → text.
* **Buffered**\* → rendiment.
* **Data\*Stream** → primitives binàries.
* **StreamReader/Writer** → control de charset.
* **PrintWriter** → text amb format.
* **try-with-resources** i **gestió d’excepcions** → bones pràctiques.

---

# 📌 Coses que faltaven en versions anteriors i ara s’han afegit

1. **Llistats de mètodes detallats** a cada classe (explicació de què fa cadascun).
2. **Exemples complets a combinacions (text)**, un per cada bullet.
3. **Explicació clara de `flush()` i `close()` dins de cada classe.**
4. **Riscos típics** explicats dins de cada classe (no sols a les taules).
5. **Exemples comentats línia a línia** en moltes seccions.
6. **Banner + exemple comparatiu sobre FileReader/FileWriter vs InputStreamReader/OutputStreamWriter.**
7. **Nota sobre rendiment i mida de buffers.**
8. **Exemples pràctics dels streams estàndard (`System.in`, `System.err`).**

