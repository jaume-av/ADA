---
title: 2.5.- Resums i Exemples Complets.
parent: 2.- Gestió del Contingut
grand_parent: Persistència de Fitxers
has_children: true
layout: default
nav_order: 50
---



## Annex C · Exemples complets “copiar–enganxar”

> Estructura de projecte esperada (Maven):
>
> ```
> src/
> ├─ main/
> │  ├─ java/edu/exemples/  (paquet del codi)
> │  └─ resources/          (JSON/XML d’entrada i eixida)
> └─ test/...
> ```
>
> **pom.xml** (essencial Jackson JSON + dates + XML):
>
> ```xml
> <dependencies>
>   <!-- JSON -->
>   <dependency>
>     <groupId>com.fasterxml.jackson.core</groupId>
>     <artifactId>jackson-databind</artifactId>
>     <version>2.18.0</version>
>   </dependency>
>   <!-- Java Time (LocalDate, etc.) -->
>   <dependency>
>     <groupId>com.fasterxml.jackson.datatype</groupId>
>     <artifactId>jackson-datatype-jsr310</artifactId>
>     <version>2.18.0</version>
>   </dependency>
>   <!-- XML -->
>   <dependency>
>     <groupId>com.fasterxml.jackson.dataformat</groupId>
>     <artifactId>jackson-dataformat-xml</artifactId>
>     <version>2.18.0</version>
>   </dependency>
> </dependencies>
> ```

---

### Exemple complet **JSON** (serialitzar i deserialitzar)

**`src/main/java/edu/exemples/Producte.java`**

```java
package edu.exemples;

// POJO senzill. Constructor buit + getters/setters perquè Jackson funcione.
public class Producte {
    private String nom;
    private double preu;
    private boolean actiu;

    public Producte() {} // obligatori per a deserialitzar

    public Producte(String nom, double preu, boolean actiu) {
        this.nom = nom;
        this.preu = preu;
        this.actiu = actiu;
    }

    public String getNom() { return nom; }
    public void setNom(String nom) { this.nom = nom; }

    public double getPreu() { return preu; }
    public void setPreu(double preu) { this.preu = preu; }

    public boolean isActiu() { return actiu; }
    public void setActiu(boolean actiu) { this.actiu = actiu; }
}
```

**`src/main/java/edu/exemples/ExempleJSON.java`**

```java
package edu.exemples;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.SerializationFeature;
import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;

import java.io.File;
import java.nio.file.Files;
import java.nio.file.Path;

public class ExempleJSON {
    public static void main(String[] args) throws Exception {
        // 1) Configurem ObjectMapper per a eixida "bonica" i dates modernes (si n'hi haguera)
        ObjectMapper om = new ObjectMapper()
                .registerModule(new JavaTimeModule())
                .disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS)
                .enable(SerializationFeature.INDENT_OUTPUT);

        // 2) Creem un objecte Java a serialitzar
        Producte p = new Producte("Teclat Mecànic", 59.90, true);

        // 3) Serialitzar a String (per veure-ho per consola)
        String json = om.writeValueAsString(p);
        System.out.println("JSON a String:\n" + json);

        // 4) Serialitzar a fitxer (carpeta de recursos)
        File out = new File("src/main/resources/producte.json");
        out.getParentFile().mkdirs(); // crea la carpeta si no existeix
        om.writeValue(out, p);
        System.out.println("S'ha escrit: " + out.getAbsolutePath());

        // 5) Deserialitzar des de fitxer (comprovem que existeix abans)
        if (out.exists()) {
            Producte llegit = om.readValue(out, Producte.class);
            System.out.println("Llegit des de fitxer → nom=" + llegit.getNom()
                    + ", preu=" + llegit.getPreu()
                    + ", actiu=" + llegit.isActiu());
        } else {
            System.err.println("No trobe el fitxer: " + out.getAbsolutePath());
        }

        // 6) Deserialitzar des de String (simule lectura d'una resposta d'API)
        String jsonEntrada = """
            { "nom": "Ratolí", "preu": 24.99, "actiu": true, "extra": "camp desconegut" }
        """;

        // Si el JSON porta claus desconegudes, pots desactivar el “fail” així:
        // om.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);

        Producte p2 = om.readValue(jsonEntrada, Producte.class);
        System.out.println("Des de String → nom=" + p2.getNom());

        // Opcional: mostrar el contingut del fitxer acabat d'escriure
        System.out.println("\nContingut producte.json:");
        System.out.println(Files.readString(Path.of("src/main/resources/producte.json")));
    }
}
```

---

### Exemple complet **XML** (serialitzar i deserialitzar)

**`src/main/java/edu/exemples/Adreca.java`**

```java
package edu.exemples;

import com.fasterxml.jackson.dataformat.xml.annotation.JacksonXmlProperty;

public class Adreca {
    @JacksonXmlProperty(isAttribute = true, localName = "tipus") // atribut de l'element <adreca>
    private String tipus;

    @JacksonXmlProperty(localName = "carrer")
    private String carrer;

    @JacksonXmlProperty(localName = "ciutat")
    private String ciutat;

    public Adreca() {}

    public Adreca(String tipus, String carrer, String ciutat) {
        this.tipus = tipus;
        this.carrer = carrer;
        this.ciutat = ciutat;
    }

    public String getTipus() { return tipus; }
    public void setTipus(String tipus) { this.tipus = tipus; }
    public String getCarrer() { return carrer; }
    public void setCarrer(String carrer) { this.carrer = carrer; }
    public String getCiutat() { return ciutat; }
    public void setCiutat(String ciutat) { this.ciutat = ciutat; }
}
```

**`src/main/java/edu/exemples/Persona.java`**

```java
package edu.exemples;

import com.fasterxml.jackson.dataformat.xml.annotation.*;

import java.util.List;

@JacksonXmlRootElement(localName = "persona") // element arrel <persona>
public class Persona {

    @JacksonXmlProperty(localName = "nom")
    private String nom;

    @JacksonXmlProperty(localName = "edat")
    private int edat;

    @JacksonXmlElementWrapper(localName = "adreces")  // <adreces> ... </adreces>
    @JacksonXmlProperty(localName = "adreca")         // elements <adreca ...>
    private List<Adreca> adreces;

    @JacksonXmlCData // volem que vaja en CDATA
    @JacksonXmlProperty(localName = "notes")
    private String notes;

    public Persona() {}

    public Persona(String nom, int edat, List<Adreca> adreces, String notes) {
        this.nom = nom;
        this.edat = edat;
        this.adreces = adreces;
        this.notes = notes;
    }

    public String getNom() { return nom; }
    public void setNom(String nom) { this.nom = nom; }
    public int getEdat() { return edat; }
    public void setEdat(int edat) { this.edat = edat; }
    public List<Adreca> getAdreces() { return adreces; }
    public void setAdreces(List<Adreca> adreces) { this.adreces = adreces; }
    public String getNotes() { return notes; }
    public void setNotes(String notes) { this.notes = notes; }
}
```

**`src/main/java/edu/exemples/ExempleXML.java`**

```java
package edu.exemples;

import com.fasterxml.jackson.dataformat.xml.XmlMapper;
import com.fasterxml.jackson.dataformat.xml.ser.ToXmlGenerator;
import com.fasterxml.jackson.databind.SerializationFeature;
import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;

import java.io.File;
import java.util.List;
import java.nio.file.Files;
import java.nio.file.Path;

public class ExempleXML {
    public static void main(String[] args) throws Exception {
        // 1) Preparam el XmlMapper (pretty-print, capçalera XML, dates modernes si cal)
        XmlMapper xml = new XmlMapper();
        xml.registerModule(new JavaTimeModule());
        xml.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS); // si usares LocalDate
        xml.enable(SerializationFeature.INDENT_OUTPUT);              // indentació bonica
        xml.configure(ToXmlGenerator.Feature.WRITE_XML_DECLARATION, true); // <?xml version="1.0" ... ?>

        // 2) Dades d'exemple
        Persona p = new Persona(
                "Jaume Aragó",
                68,
                List.of(
                        new Adreca("casa", "Avinguda Datileres", "Benizahat"),
                        new Adreca("oficina", "Canto del Bobet", "Benigaslo")
                ),
                "Esta és una persona molt important."
        );

        // 3) Serialitzar a String (per consola)
        String xmlString = xml.writeValueAsString(p);
        System.out.println("XML a String:\n" + xmlString);

        // 4) Serialitzar a fitxer
        File out = new File("src/main/resources/persona.xml");
        out.getParentFile().mkdirs();
        xml.writeValue(out, p);
        System.out.println("S'ha escrit: " + out.getAbsolutePath());

        // 5) Deserialitzar des de String (simulant lectura de xarxa)
        String entrada = """
            <persona>
                <nom>Maria</nom>
                <edat>40</edat>
                <adreces>
                    <adreca tipus="casa">
                        <carrer>Carrer Major</carrer>
                        <ciutat>Alcoi</ciutat>
                    </adreca>
                </adreces>
                <notes><![CDATA[Comentari intern amb <caràcters> especials]]></notes>
            </persona>
        """;
        Persona p2 = xml.readValue(entrada, Persona.class);
        System.out.println("Des de String → nom=" + p2.getNom() + ", edat=" + p2.getEdat());

        // 6) Deserialitzar des de fitxer (verifica existència)
        if (out.exists()) {
            Persona p3 = xml.readValue(out, Persona.class);
            System.out.println("Des de fitxer → " + p3.getNom() + " (" + p3.getAdreces().size() + " adreces)");
        } else {
            System.err.println("No trobe el fitxer: " + out.getAbsolutePath());
        }

        // 7) Mostrar el contingut del fitxer XML
        System.out.println("\nContingut persona.xml:");
        System.out.println(Files.readString(Path.of("src/main/resources/persona.xml")));
    }
}
```

---

### Mètodes de mapper

**ObjectMapper** (JSON)

* Escriure: `writeValueAsString(obj)`, `writeValue(File, obj)`, `writerWithDefaultPrettyPrinter()...`
* Llegir: `readValue(String/File, Classe.class)`, `readTree(...) → JsonNode`
* Lectors/escriptors tipats: `readerFor(Classe)`, `writer()`
* Configuració útil: `INDENT_OUTPUT`, `FAIL_ON_UNKNOWN_PROPERTIES (desactivar)`, `JavaTimeModule`

**XmlMapper** (XML)

* Mateixos mètodes d’escriure/llegir.
* Config extra: `ToXmlGenerator.Feature.WRITE_XML_DECLARATION`, anotacions XML (`@JacksonXml...`)

---

