

# **API REST per a la Gesti√≥ de Ciutats, Prov√≠ncies i Pa√Øsos**

En esta API gestionarem informaci√≥ sobre ciutats, prov√≠ncies, pa√Øsos i franqu√≠cies. Farem √∫s de **Spring Boot**, **Spring Data JPA** i una base de dades relacional. Implementarem **repositoris DAO** per a accedir a la base de dades i **controladors REST** per a gestionar les operacions principals.

---

## **Repositoris (DAOs)**
Cada entitat necessita un **repositori** per a interactuar amb la base de dades. Farem servir **JpaRepository**, que ens proporciona m√®todes predefinits per a operacions CRUD.

```java
package com.jaume.Provincies.repositories;

import com.jaume.Provincies.model.Entitats.*;
import org.springframework.data.jpa.repository.JpaRepository;

public interface CiutatRepository extends JpaRepository<Ciutat, Long> {}
public interface ProvinciaRepository extends JpaRepository<Provincia, Long> {}
public interface PaisRepository extends JpaRepository<Pais, Long> {}
public interface FranquiciaRepository extends JpaRepository<Franquicia, Long> {}
public interface CiutatFranquiciaRepository extends JpaRepository<CiutatFranquicia, Long> {}
```

---

## **Controladors REST**
Cada **controlador REST** gestionar√† les operacions principals (**GET, POST i DELETE**) per a cada entitat.

---

### **Controlador de Ciutats**
```java
package com.jaume.Provincies.controllers;

import com.jaume.Provincies.model.Entitats.Ciutat;
import com.jaume.Provincies.repositories.CiutatRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/ciutats")
public class CiutatController {

    @Autowired
    private CiutatRepository ciutatRepository; // Injecci√≥ del repositori per accedir a la BD

    // Obt√© totes les ciutats
    @GetMapping
    public List<Ciutat> getAllCiutats() {
        return ciutatRepository.findAll();
    }

    // Crea una nova ciutat
    @PostMapping
    public ResponseEntity<Ciutat> createCiutat(@RequestBody Ciutat ciutat) {
        return new ResponseEntity<>(ciutatRepository.save(ciutat), HttpStatus.CREATED);
    }

    // Esborra una ciutat per ID
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteCiutat(@PathVariable Long id) {
        if (ciutatRepository.existsById(id)) {
            ciutatRepository.deleteById(id);
            return ResponseEntity.noContent().build();
        }
        return ResponseEntity.notFound().build();
    }
}
```

---

### **Controlador de Prov√≠ncies**
```java
@RestController
@RequestMapping("/api/provincies")
public class ProvinciaController {

    @Autowired
    private ProvinciaRepository provinciaRepository; // Injecci√≥ del repositori per accedir a la BD

    // Obt√© totes les prov√≠ncies
    @GetMapping
    public List<Provincia> getAllProvincies() {
        return provinciaRepository.findAll();
    }

    // Crea una nova prov√≠ncia
    @PostMapping
    public ResponseEntity<Provincia> createProvincia(@RequestBody Provincia provincia) {
        return new ResponseEntity<>(provinciaRepository.save(provincia), HttpStatus.CREATED);
    }

    // Esborra una prov√≠ncia per ID
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteProvincia(@PathVariable Long id) {
        if (provinciaRepository.existsById(id)) {
            provinciaRepository.deleteById(id);
            return ResponseEntity.noContent().build();
        }
        return ResponseEntity.notFound().build();
    }
}
```

---

### **Controlador de Pa√Øsos**
```java
@RestController
@RequestMapping("/api/paisos")
public class PaisController {

    @Autowired
    private PaisRepository paisRepository; // Injecci√≥ del repositori per accedir a la BD

    // Obt√© tots els pa√Øsos
    @GetMapping
    public List<Pais> getAllPaisos() {
        return paisRepository.findAll();
    }

    // Crea un nou pa√≠s
    @PostMapping
    public ResponseEntity<Pais> createPais(@RequestBody Pais pais) {
        return new ResponseEntity<>(paisRepository.save(pais), HttpStatus.CREATED);
    }

    // Esborra un pa√≠s per ID
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deletePais(@PathVariable Long id) {
        if (paisRepository.existsById(id)) {
            paisRepository.deleteById(id);
            return ResponseEntity.noContent().build();
        }
        return ResponseEntity.notFound().build();
    }
}
```

---

### **Controlador de Franqu√≠cies**
```java
@RestController
@RequestMapping("/api/franquicies")
public class FranquiciaController {

    @Autowired
    private FranquiciaRepository franquiciaRepository; // Injecci√≥ del repositori per accedir a la BD

    // Obt√© totes les franqu√≠cies
    @GetMapping
    public List<Franquicia> getAllFranquicies() {
        return franquiciaRepository.findAll();
    }

    // Crea una nova franqu√≠cia
    @PostMapping
    public ResponseEntity<Franquicia> createFranquicia(@RequestBody Franquicia franquicia) {
        return new ResponseEntity<>(franquiciaRepository.save(franquicia), HttpStatus.CREATED);
    }

    // Esborra una franqu√≠cia per ID
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteFranquicia(@PathVariable Long id) {
        if (franquiciaRepository.existsById(id)) {
            franquiciaRepository.deleteById(id);
            return ResponseEntity.noContent().build();
        }
        return ResponseEntity.notFound().build();
    }
}
```

---

### **Controlador de Ciutat-Franqu√≠cia (Relaci√≥ N:M)**
```java
@RestController
@RequestMapping("/api/ciutat-franquicies")
public class CiutatFranquiciaController {

    @Autowired
    private CiutatFranquiciaRepository ciutatFranquiciaRepository; // Injecci√≥ del repositori per accedir a la BD

    // Obt√© totes les relacions ciutat-franqu√≠cia
    @GetMapping
    public List<CiutatFranquicia> getAllCiutatFranquicies() {
        return ciutatFranquiciaRepository.findAll();
    }

    // Crea una nova relaci√≥ ciutat-franqu√≠cia
    @PostMapping
    public ResponseEntity<CiutatFranquicia> createCiutatFranquicia(@RequestBody CiutatFranquicia ciutatFranquicia) {
        return new ResponseEntity<>(ciutatFranquiciaRepository.save(ciutatFranquicia), HttpStatus.CREATED);
    }

    // Esborra una relaci√≥ ciutat-franqu√≠cia per ID
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteCiutatFranquicia(@PathVariable Long id) {
        if (ciutatFranquiciaRepository.existsById(id)) {
            ciutatFranquiciaRepository.deleteById(id);
            return ResponseEntity.noContent().build();
        }
        return ResponseEntity.notFound().build();
    }
}
```

---

Ac√≠ tens el **ProvinciesRestController** que agrupa tots els controladors en un √∫nic fitxer. Aix√≤ facilita la gesti√≥ de les entitats i centralitza totes les operacions REST.

---

### **ProvinciesRestController.java**
```java
package com.jaume.Provincies.controllers;

import com.jaume.Provincies.model.Entitats.*;
import com.jaume.Provincies.repositories.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api")
public class ProvinciesRestController {

    @Autowired
    private CiutatRepository ciutatRepository;

    @Autowired
    private ProvinciaRepository provinciaRepository;

    @Autowired
    private PaisRepository paisRepository;

    @Autowired
    private FranquiciaRepository franquiciaRepository;

    @Autowired
    private CiutatFranquiciaRepository ciutatFranquiciaRepository;

    // -------------------------------
    // CIUTATS
    // -------------------------------

    // Obt√© totes les ciutats
    @GetMapping("/ciutats")
    public List<Ciutat> getAllCiutats() {
        return ciutatRepository.findAll();
    }

    // Crea una nova ciutat
    @PostMapping("/ciutats")
    public ResponseEntity<Ciutat> createCiutat(@RequestBody Ciutat ciutat) {
        return new ResponseEntity<>(ciutatRepository.save(ciutat), HttpStatus.CREATED);
    }

    // Esborra una ciutat per ID
    @DeleteMapping("/ciutats/{id}")
    public ResponseEntity<Void> deleteCiutat(@PathVariable Long id) {
        if (ciutatRepository.existsById(id)) {
            ciutatRepository.deleteById(id);
            return ResponseEntity.noContent().build();
        }
        return ResponseEntity.notFound().build();
    }

    // -------------------------------
    // PROV√çNCIES
    // -------------------------------

    // Obt√© totes les prov√≠ncies
    @GetMapping("/provincies")
    public List<Provincia> getAllProvincies() {
        return provinciaRepository.findAll();
    }

    // Crea una nova prov√≠ncia
    @PostMapping("/provincies")
    public ResponseEntity<Provincia> createProvincia(@RequestBody Provincia provincia) {
        return new ResponseEntity<>(provinciaRepository.save(provincia), HttpStatus.CREATED);
    }

    // Esborra una prov√≠ncia per ID
    @DeleteMapping("/provincies/{id}")
    public ResponseEntity<Void> deleteProvincia(@PathVariable Long id) {
        if (provinciaRepository.existsById(id)) {
            provinciaRepository.deleteById(id);
            return ResponseEntity.noContent().build();
        }
        return ResponseEntity.notFound().build();
    }

    // -------------------------------
    // PA√èSOS
    // -------------------------------

    // Obt√© tots els pa√Øsos
    @GetMapping("/paisos")
    public List<Pais> getAllPaisos() {
        return paisRepository.findAll();
    }

    // Crea un nou pa√≠s
    @PostMapping("/paisos")
    public ResponseEntity<Pais> createPais(@RequestBody Pais pais) {
        return new ResponseEntity<>(paisRepository.save(pais), HttpStatus.CREATED);
    }

    // Esborra un pa√≠s per ID
    @DeleteMapping("/paisos/{id}")
    public ResponseEntity<Void> deletePais(@PathVariable Long id) {
        if (paisRepository.existsById(id)) {
            paisRepository.deleteById(id);
            return ResponseEntity.noContent().build();
        }
        return ResponseEntity.notFound().build();
    }

    // -------------------------------
    // FRANQU√çCIES
    // -------------------------------

    // Obt√© totes les franqu√≠cies
    @GetMapping("/franquicies")
    public List<Franquicia> getAllFranquicies() {
        return franquiciaRepository.findAll();
    }

    // Crea una nova franqu√≠cia
    @PostMapping("/franquicies")
    public ResponseEntity<Franquicia> createFranquicia(@RequestBody Franquicia franquicia) {
        return new ResponseEntity<>(franquiciaRepository.save(franquicia), HttpStatus.CREATED);
    }

    // Esborra una franqu√≠cia per ID
    @DeleteMapping("/franquicies/{id}")
    public ResponseEntity<Void> deleteFranquicia(@PathVariable Long id) {
        if (franquiciaRepository.existsById(id)) {
            franquiciaRepository.deleteById(id);
            return ResponseEntity.noContent().build();
        }
        return ResponseEntity.notFound().build();
    }

    // -------------------------------
    // CIUTAT-FRANQU√çCIA (RELACI√ì N:M)
    // -------------------------------

    // Obt√© totes les relacions ciutat-franqu√≠cia
    @GetMapping("/ciutat-franquicies")
    public List<CiutatFranquicia> getAllCiutatFranquicies() {
        return ciutatFranquiciaRepository.findAll();
    }

    // Crea una nova relaci√≥ ciutat-franqu√≠cia
    @PostMapping("/ciutat-franquicies")
    public ResponseEntity<CiutatFranquicia> createCiutatFranquicia(@RequestBody CiutatFranquicia ciutatFranquicia) {
        return new ResponseEntity<>(ciutatFranquiciaRepository.save(ciutatFranquicia), HttpStatus.CREATED);
    }

    // Esborra una relaci√≥ ciutat-franqu√≠cia per ID
    @DeleteMapping("/ciutat-franquicies/{id}")
    public ResponseEntity<Void> deleteCiutatFranquicia(@PathVariable Long id) {
        if (ciutatFranquiciaRepository.existsById(id)) {
            ciutatFranquiciaRepository.deleteById(id);
            return ResponseEntity.noContent().build();
        }
        return ResponseEntity.notFound().build();
    }
}
```

---

## **Explicaci√≥ i avantatges**
1. **S'han fusionat tots els controladors en un sol fitxer** (`ProvinciesRestController.java`) per a una millor organitzaci√≥.
2. **Les rutes segueixen una estructura clara** (`/api/ciutats`, `/api/provincies`, `/api/paisos`, etc.).
3. **S'ha mantingut la injecci√≥ de depend√®ncies amb `@Autowired`** per a cada repositori.
4. **Cada entitat t√© operacions GET, POST i DELETE**, mantenint la l√≤gica CRUD.
5. **El codi est√† ben estructurat amb comentaris** per a una lectura m√©s f√†cil.

Ara pots gestionar **Ciutats, Prov√≠ncies, Pa√Øsos i Franqu√≠cies** des d'un √∫nic **controlador REST**, mantenint un codi m√©s net i eficient. üöÄ